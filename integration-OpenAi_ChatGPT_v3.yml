category: Messaging and Conferencing
commonfields:
  id: OpenAi ChatGPT v3
  version: -1
configuration:
- defaultvalue: https://api.openai.com/
  display: 'Server URL: (e.g. https://api.openai.com/)'
  name: url
  required: true
  section: Connect
  type: 0
- display: ""
  displaypassword: API Key
  hiddenusername: true
  name: apikey
  required: true
  section: Connect
  type: 9
- display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- display: Use system proxy settings
  name: proxy
  required: false
  type: 8
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 6.0.0
    itemVersion: 1.1.2
    packID: OpenAI
    packName: OpenAI
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: |-
  This integration provides access to the OpenAI ChatGPT API, which generates human-like responses to text prompts.

  OpenAI ChatGPT is a revolutionary conversational AI system that is designed to interact with humans just like real people, this cutting-edge system is capable of understanding human language, responding to complex queries, and even mimicking human personality traits. Using advanced natural language processing techniques, OpenAI ChatGPT can simulate human conversation to an unprecedented degree of accuracy and effectiveness, making it an ideal tool for a wide range of applications, including customer service, virtual assistance, and more.
detaileddescription: |-
  ### Community Contributed Integration
   #### Integration Author: NVISO & Sameh El-Hakim
   No support or maintenance is provided by the author. Customers are encouraged to engage with the user community for questions and guidance at the [Cortex XSOAR Live Discussions](https://live.paloaltonetworks.com/t5/cortex-xsoar-discussions/bd-p/Cortex_XSOAR_Discussions).
  ***
  #### Integration Author: Sameh El-Hakim
  This integration for OpenAi ChatGPT API v3 - using Model: gpt-3.5-turbo
  ***
  The following Description is generated by ChatGPT Integration:
  OpenAI ChatGPT is a revolutionary conversational AI system that is designed to interact with humans just like real people. Developed by one of the most innovative and respected names in the field of artificial intelligence, this cutting-edge system is capable of understanding human language, responding to complex queries, and even mimicking human personality traits. Using advanced natural language processing techniques, OpenAI ChatGPT can simulate human conversation to an unprecedented degree of accuracy and effectiveness, making it an ideal tool for a wide range of applications, including customer service, virtual assistance, and more. Whether you are looking for a smarter way to engage with your customers or simply want to explore the cutting edge of AI technology, OpenAI ChatGPT is the perfect solution for all your conversational needs.


  ## OpenAi ChatGPT V3
  ### This section explains how to configure the instance of OpenAi ChatGPT V3 in Cortex XSOAR.
  - Login to OpenAi API
  - Click on Create New Secret Key
  - Copy the key to the left parameter
  - URL is default "To Change it Check OpenAI API Guide"
  - Click Test

  ## How to use this integration with XSOAR
  ### The following page 'Palo Alto Networks - Playbook of the week' explains how to use this integration in your playbooks:

  https://www.paloaltonetworks.com/blog/security-operations/using-chatgpt-in-cortex-xsoar/

  ---
  [View Integration Documentation](https://xsoar.pan.dev/docs/reference/integrations/open-ai-chat-gpt-v3)
display: OpenAi ChatGPT v3 (Community Contribution)
image: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAAyCAQAAAA9rtdTAAAC7HpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHja7ZZRkuQmDIbfOUWOYEkIieNgMFV7gxw/vzDdme6ZrcpkXwfKgIUsCX1Ad7r+/jXTXyiU6UhZzUst5UDJNVduGPhxl7ZaOvJqV7HHHL3Kk/CeYIgEvdyvXrb+Q05PA3fXMNIPhrzvifN1ouZt398MbccSEcV4bEN1GxK+J2gbaPeyjlLdPi7hvO5+f3+nAU+KJvtr2J/eDdkbCj/CfAnJgVZkByDxcJKGCUZ7iEKRRJekolWp2xgS8lWengV6aUao+UulFyrP0RutslOQ3mll3iryluTy7L+UJ9K3CXn654+es+8Rv8qRqnxH9Jb9eOYcPteasYqWC1Jd9qIeS1wj6J1wEa49IbRyGB6FCVu1ojp2dcdWGEc/TtROlRi4Jo7DoEaTrtV36ggx85XYMGDuLEvoYly5S/DLUWmygeEQB9u+sGfhZyy03Najp+XN4XkQVJlgLLbDt2v67gdzxlEgilyWtnKFuJgj2QgjyEULNTCguZOqK8GP+l6CazDTyHIckYrEnreJU+nfm0AWaIGior/PINnYBpAiuFYEQwICoIZTQYUOYzYiJNIBqCF0lswnCJAqDwTJWaSAjXO4xidGS5WVIU6Q4zIDCZUiBjY4ZYCVs2L/WHbsoaaiWVWLmrpWbUVKLlpKsRKXYjOxnEytmJlbtebi2dWLm7tXb5Wr4NLUWqpVr7W2Bp8Nlhu+blBo7eRTznxqOstpp5/1bB3bp+euvXTr3mtvg4cM3B+jDBs+6mgXXdhKV770KpddftWrTWy1KWnmqbNMmz7rbE9qG+un+g1qtKnxIhWK9qQGqdnDBMV1osEMwDhlAnELBNjQHMwOp5w5yAWzozJOhTKC1GA2KIiBYL6IddKDXeKbaJD7I27J8gs3/r/kUqD7JrnP3L6iNuIO7ovYfQojqYfg9GH+8sbe4sfuU59+N/Hd/sfQj6EfQ//B0MRhjX9d/wD0sozpdVfjlAAAASRpQ0NQSUNDIHByb2ZpbGUAAHicnZC/SsNQFMZ/qX+R6qDiIA4ZXAsuzeRSFYKgEGMFq1OapFhMYkhSim/gm+jDdBAEH8EHUHD2u9HBwSxeOHw/Dud8370XWnYSpuX8HqRZVbh+b3A5uLKX3mizwBrrdIOwzHued0Lj+XzFMvrSMV7Nc3+exSguQ+lMlYV5UYG1L3amVW5YxeZt3z8UP4jtKM0i8ZN4N0ojw2bXT5NJ+ONpbtOOs4tz01ft4HLMKR42QyaMSajoSDN1jnDoSl0KAu4pCaUJsXpTzVTciEo5uRyI+iLdpiFvu87zlDKUx1heJuGOVJ4mD/O/32sfZ/WmtTXLgyKoW3Oq1mgE74+wOoCNZ1i5bsha/v22hhmnnvnnG78A9ntQbHCFARIAAA0aaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA0LjQuMC1FeGl2MiI+CiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICB4bWxuczpHSU1QPSJodHRwOi8vd3d3LmdpbXAub3JnL3htcC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgeG1wTU06RG9jdW1lbnRJRD0iZ2ltcDpkb2NpZDpnaW1wOjExZWVlMTlmLWRhNjEtNDliNi05MjEwLTcxM2UwOTFiMWViNiIKICAgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo4MGRiNGZhMS1lYWRmLTQ2MjQtOTM3MS1kNjY3MTI4ZjFkMDYiCiAgIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpiMGJhYmZlYy1mNDk1LTRlMDQtODYzYS05ZjQ0OWM4NDg5YjQiCiAgIGRjOkZvcm1hdD0iaW1hZ2UvcG5nIgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3JtPSJMaW51eCIKICAgR0lNUDpUaW1lU3RhbXA9IjE2NzAyNTAwMDEyMzI1MTgiCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4zMCIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgeG1wOkNyZWF0b3JUb29sPSJHSU1QIDIuMTAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hhbmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpiYjY4ZjJmOC1lNGUwLTRiNGItYmM5Ni1jMWIxNTcwYTk0NDEiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkdpbXAgMi4xMCAoTGludXgpIgogICAgICBzdEV2dDp3aGVuPSIyMDIyLTEyLTA1VDE1OjIwOjAxKzAxOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PljaFOkAAAACYktHRAD/h4/MvwAAAAlwSFlzAAALEwAACxMBAJqcGAAA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
name: OpenAi ChatGPT v3
script:
  commands:
  - arguments:
    - description: Add your question or text
      name: prompt
      required: true
    description: Send Text Message as a prompt to ChatGPT
    name: chatgpt-send-prompt
  dockerimage: demisto/python3:3.10.12.63474
  runonce: false
  script: |
    register_module_line('OpenAi ChatGPT v3', 'start', __line__())
    ### pack version: 1.1.2


    import json
    import urllib3


    urllib3.disable_warnings()


    ''' CLIENT CLASS '''


    class Client(BaseClient):
        """ Client class to interact with the OpenAI ChatGPT API v3
        """

        def __init__(self, api_key: str, base_url: str, proxy: bool, verify: bool):
            super().__init__(base_url=base_url, proxy=proxy, verify=verify)
            self.api_key = api_key
            self.base_url = base_url
            self.headers = {'Authorization': f"Bearer {self.api_key}", "Content-Type": "application/json"}

        def chatgpt(self, prompt: str):
            options = {"max_tokens": 1000, "model": "gpt-3.5-turbo", "messages": [{"role": "user", "content": prompt}]}
            return self._http_request(method='POST', url_suffix='v1/chat/completions', json_data=options, headers=self.headers)


    ''' COMMAND FUNCTIONS '''


    def test_module(client: Client) -> str:
        """
        Tests API connectivity and authentication'
        Returning 'ok' indicates that connection to the service is successful.
        Raises exceptions if something goes wrong.
        """
        response = client.chatgpt('Hello!')
        status = ''
        try:
            if response:
                status = 'ok'
                return status
        except Exception as e:
            exception_text = str(e).lower()
            if 'forbidden' in exception_text or 'authorization' in exception_text:
                status = 'Authorization Error: make sure API Key is correctly set'
                return status
            else:
                raise e

        return status


    def chatgpt_send_prompt_command(client: Client, prompt: str) -> CommandResults:
        """
        Command to send prompts to OpenAI ChatGPT API
        and receive a response converted into json then
        returned to Output function to convert it to markdown table

        :type client: ``Client``
        :param prompt:  arguments
        """
        if not prompt:
            raise DemistoException('the prompt argument cannot be empty.')

        chatgpt_response = client.chatgpt(prompt)

        return chatgpt_output(chatgpt_response)


    def chatgpt_output(response) -> CommandResults:
        """
        Convert response from ChatGPT to a human readable format in markdown table

        :return: CommandResults return output of ChatGPT response
        :rtype: ``CommandResults``
        """
        if response and isinstance(response, dict):
            rep = json.dumps(response)
            repJSON = json.loads(rep)
            model = repJSON.get('model')
            createdTime = repJSON.get('created')
            id = repJSON.get('id')
            choices = repJSON.get('choices', [])[0].get('message', {}).get('content', "").strip('\n')
            promptTokens = repJSON.get('usage', {}).get('prompt_tokens')
            completionTokens = repJSON.get('usage', {}).get('completion_tokens')
            totalTokens = repJSON.get('usage', {}).get('total_tokens')
            context = [{'ID': id, 'Model': model,
                        'ChatGPT Response': choices, 'Created Time': createdTime,
                        'Number of Prompt Tokens': promptTokens,
                        'Number of Completion Tokens': completionTokens,
                        'Number of Total Tokens': totalTokens
                        }]

            markdown = tableToMarkdown(
                'ChatGPT API Response',
                context,
                date_fields=['Created Time'],
            )

            results = CommandResults(
                readable_output=markdown,
                outputs_prefix='ChatGPTResponse',
                outputs_key_field='id',
                outputs=context
            )

            return results
        else:
            raise DemistoException('Error in results')


    ''' MAIN FUNCTION '''


    def main() -> None:
        """main function, runs command functions
        """
        params = demisto.params()
        args = demisto.args()
        command = demisto.command()

        api_key = params.get('apikey', {}).get('password')
        base_url = params.get('url', '')
        verify = not params.get('insecure', False)
        proxy = params.get('proxy', False)

        demisto.debug(f'Command being called is {command}')
        try:
            client = Client(api_key=api_key, base_url=base_url, verify=verify, proxy=proxy)

            if command == 'test-module':
                # This is the call made when clicking the integration Test button.
                return_results(test_module(client))

            elif command == 'chatgpt-send-prompt':
                return_results(chatgpt_send_prompt_command(client, **args))

            else:
                raise NotImplementedError(f"command {command} is not implemented.")

        # Log exceptions and return errors
        except Exception as e:
            demisto.error(traceback.format_exc())  # print the traceback
            return_error("\n".join(("Failed to execute {command} command.",
                                    "Error:",
                                    str(e))))


    ''' ENTRY POINT '''


    if __name__ in ('__main__', '__builtin__', 'builtins'):
        main()

    register_module_line('OpenAi ChatGPT v3', 'end', __line__())
  subtype: python3
  type: python
system: true
