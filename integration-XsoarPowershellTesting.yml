category: Utilities
commonfields:
  id: XsoarPowershellTesting
  version: -1
configuration: []
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 5.5.0
    itemVersion: 1.3.15
    packID: DeveloperTools
    packName: Developer Tools
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: Powershell Integration for testing that Powershell support is working
  as expected.
detaileddescription: |-
  ### Community Contributed Integration
   #### Integration Author: Cortex XSOAR
   No support or maintenance is provided by the author. Customers are encouraged to engage with the user community for questions and guidance at the [Cortex XSOAR Live Discussions](https://live.paloaltonetworks.com/t5/cortex-xsoar-discussions/bd-p/Cortex_XSOAR_Discussions).
  ***
  # XSOAR Server Powershell
  Powershell Integration for testing that Powershell support is working as expected.
display: XSOAR Powershell Testing (Community Contribution)
image: data:image/png;base64,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
name: XsoarPowershellTesting
script:
  commands:
  - arguments: []
    description: Get integration context.
    name: pwsh-test-get-integration-context
    outputs:
    - contextPath: XSOAR.IntegrationContext.Value
      description: Integration context value.
      type: String
  - arguments: []
    description: Get integration versioned context.
    name: pwsh-test-get-integration-versioned-context
    outputs:
    - contextPath: XSOAR.IntegrationContext.Value
      description: Integration context object.
      type: Unknown
    - contextPath: XSOAR.Version
      description: Integration context version number.
      type: Unknown
  - arguments:
    - description: Value to set in integration context.
      name: value
      required: true
    description: Set integration context.
    name: pwsh-test-set-integration-context
  - arguments:
    - description: Value to set in integration context.
      name: value
      required: true
    - description: The context version to update.
      name: version
      required: true
    description: Set integration versioned context.
    name: pwsh-test-set-integration-versioned-context
  dockerimage: demisto/powershell-ubuntu:7.2.2.29705
  runonce: false
  script: |
    ### pack version: 1.3.15


    $script:INTEGRATION_NAME = "XSOAR Powershell Testing"
    $script:COMMAND_PREFIX = "pwsh-test"
    $script:INTEGRATION_ENTRY_CONTEX = "XSOAR"

    #### HELPER FUNCTIONS ####

    function TestModuleCommand() {
        # Raw response
        $raw_response = $null
        # Human readable
        $human_readable = "ok"
        # Entry context
        $entry_context = $null

        return $human_readable, $entry_context, $raw_response
    }

    function GetIntegrationContextCommand() {
        # Raw response
        $raw_response = GetIntegrationContext
        $raw_response_json = $raw_response | ConvertTo-Json
        # Human readable
        $human_readable = "Integration context value is **$raw_response_json**"
        # Entry context
        $entry_context = @{}
        $entry_context = @{
            "$script:INTEGRATION_ENTRY_CONTEX.IntegrationContext" = $raw_response
        }

        return $human_readable, $entry_context, $raw_response
    }

    function SetIntegrationContextCommand([hashtable]$kwargs) {
        # Raw response
        $integration_context = @{
        "Value" = $kwargs.value
        }
        SetIntegrationContext $integration_context
        $raw_response = @{}
        # Human readable
        $human_readable = "Integration context value set to **$($kwargs.value)** "
        # Entry context
        $entry_context = @{}

        return $human_readable, $entry_context, $raw_response
    }

    function SetVersionedIntegrationContextCommand([hashtable]$kwargs) {
        # Raw response
        $integration_context = @{
        "Value" = $kwargs.value
        }
        $version = $kwargs.version

        SetIntegrationContext -context $integration_context -version $version
        $raw_response = @{}
        # Human readable
        $human_readable = "Integration context with version **$($version)** value set to **$($kwargs.value)** "
        # Entry context
        $entry_context = @{}

        return $human_readable, $entry_context, $raw_response
    }

    function GetVersionedIntegrationContextCommand() {
        # Raw response
        $raw_response = GetIntegrationContext -withVersion $true
        $raw_response_json = $raw_response | ConvertTo-Json
        # Human readable
        $human_readable = "Integration context with version is **$raw_response_json**"
        # Entry context
        $entry_context = @{}

        if (DemistoVersionGreaterEqualThen -version "6.1.0") {
            $version = $raw_response.version.version
        }
        else {
             $version = $raw_response.version
        }

        $entry_context = @{
            $script:INTEGRATION_ENTRY_CONTEX = @{
                "IntegrationContext" = $raw_response.context
                "Version" = $version
            }
        }

        return $human_readable, $entry_context, $raw_response
    }

    #### INTEGRATION COMMANDS MANAGER ####

    function Main {
        $command = $Demisto.GetCommand()
        $command_arguments = $Demisto.Args()

        try {
            # Executing command
            $Demisto.Debug("Command being called is $Command")
            switch ($command) {
                "test-module" {
                    ($human_readable, $entry_context, $raw_response) = TestModuleCommand
                }
                "$script:COMMAND_PREFIX-get-integration-context" {
                    ($human_readable, $entry_context, $raw_response) = GetIntegrationContextCommand
                }
                "$script:COMMAND_PREFIX-set-integration-context" {
                    ($human_readable, $entry_context, $raw_response) = SetIntegrationContextCommand $command_arguments
                }
                "$script:COMMAND_PREFIX-get-integration-versioned-context" {
                    ($human_readable, $entry_context, $raw_response) = GetVersionedIntegrationContextCommand
                }
                "$script:COMMAND_PREFIX-set-integration-versioned-context" {
                    ($human_readable, $entry_context, $raw_response) = SetVersionedIntegrationContextCommand $command_arguments
                }
            }
            # Return results to Demisto Server
            ReturnOutputs $human_readable $entry_context $raw_response | Out-Null
        }
        catch {
            $Demisto.debug("Integration: $script:INTEGRATION_NAME
    Command: $command
    Arguments: $($command_arguments | ConvertTo-Json)
    Error: $($_.Exception.Message)")
            if ($command -ne "test-module") {
                ReturnError "Error:
                Integration: $script:INTEGRATION_NAME
                Command: $command
                Arguments: $($command_arguments | ConvertTo-Json)
                Error: $($_.Exception)" | Out-Null
            }
            else {
                ReturnError $_.Exception.Message
            }
        }
    }

    # Execute Main when not in Tests
    if ($MyInvocation.ScriptName -notlike "*.tests.ps1" -AND -NOT $Test) {
        Main
    }
  type: powershell
system: true
