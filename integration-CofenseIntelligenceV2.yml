category: Data Enrichment & Threat Intelligence
commonfields:
  id: CofenseIntelligenceV2
  version: -1
configuration:
- defaultvalue: https://www.threathq.com
  display: Server URL
  name: url
  required: true
  type: 0
- display: Token Name
  name: credentials
  required: true
  type: 9
- additionalinfo: Reliability of the source providing the intelligence data.
  defaultvalue: B - Usually reliable
  display: Source Reliability
  name: integration_reliability
  options:
  - A+ - 3rd party enrichment
  - A - Completely reliable
  - B - Usually reliable
  - C - Fairly reliable
  - D - Not usually reliable
  - E - Unreliable
  - F - Reliability cannot be judged
  required: false
  type: 15
- additionalinfo: Threshold for IP related threats' severity.
  defaultvalue: Major
  display: IP Threshold
  name: ip_threshold
  options:
  - None
  - Minor
  - Moderate
  - Major
  required: false
  type: 15
- additionalinfo: Threshold for file related threats' severity.
  defaultvalue: Major
  display: File Threshold
  name: file_threshold
  options:
  - None
  - Minor
  - Moderate
  - Major
  required: false
  type: 15
- additionalinfo: Threshold for URL related threats' severity.
  defaultvalue: Major
  display: URL Threshold
  name: url_threshold
  options:
  - None
  - Minor
  - Moderate
  - Major
  required: false
  type: 15
- additionalinfo: Threshold for email related threats' severity.
  defaultvalue: Major
  display: Email Threshold
  name: email_threshold
  options:
  - None
  - Minor
  - Moderate
  - Major
  required: false
  type: 15
- additionalinfo: Threshold for domain related threats' severity.
  defaultvalue: Major
  display: Domain Threshold
  name: domain_threshold
  options:
  - None
  - Minor
  - Moderate
  - Major
  required: false
  type: 15
- additionalinfo: The maximum number of days from which to start returning data. 90
    days is recommended by Cofense.
  defaultvalue: "90"
  display: Time limit for collecting data
  name: days_back
  required: false
  type: 0
- additionalinfo: |-
    Mapping of Cofense Intelligence indicator rating to XSOAR DBOT Score
    standard rating.
    For Example-: None:0, Minor:1, Moderate:2, Major:3

    Note: Cofense Indicator ratings are Major, Minor, Moderate, None.
  defaultvalue: None:0, Minor:1, Moderate:2, Major:3
  display: Score Mapping
  name: scoreMapping
  required: false
  type: 0
- additionalinfo: Create relationships between indicators as part of Enrichment.
  defaultvalue: "true"
  display: Create relationships
  name: createRelationship
  required: false
  type: 8
- display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- display: Use system proxy settings
  name: proxy
  required: false
  type: 8
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 5.5.0
    itemVersion: 1.1.15
    packID: CofenseIntelligenceV2
    packName: Cofense Intelligence v2
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: Use the Cofense Intelligence integration to check the reputation of domains,
  URLs, IP addresses, file hashes, and email addresses.
detaileddescription: |-
  ### Partner Contributed Integration
  #### Integration Author: Cofense
  Support and maintenance for this integration are provided by the author. Please use the following contact details:
  - **Email**: [support@cofense.com](mailto:support@cofense.com)
  - **URL**: [https://cofense.com/contact-support/](https://cofense.com/contact-support/)
  ***
  ## Cofense Intelligence v2

  How to generate an API Token and configure a new instance:
  - Log in to your Threathq account: [https://www.threathq.com](https://www.threathq.com)
  - Navigate to 'API Tokens' and select 'Create New Token'.
  - Copy the new generated User Token and Password to the corresponding fields in the instance configuration.





  ---
  [View Integration Documentation](https://xsoar.pan.dev/docs/reference/integrations/cofense-intelligence-v2)
display: Cofense Intelligence v2 (Partner Contribution)
image: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAAyCAYAAACXpx/YAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAA6kSURBVHgB7Vx9cFTVFT/37W4SqyRLEVqEMo8OoRhAEzESHAoLo+2MWAlo1VJpPtpOtVQDzHSmfFQWOxb4Qwyjgn8U3Fi0frTJ0oLVtsKCjkYRiAJRgWmeSsAK6AYCvOzHuz3n7r7Ne7tvv5INZJz9zbx5791373l37++ec885770FyCOPPPLIY5CCQQ5RJFfJDge4GPAS4Gwobk5g3E/XOAOFc1DsoaI2v+LzQx6XBP0i2Cm7nGGHWi0xNhe45kJxzgyb+jhwrxRk2/xKqwJ5DBj6RDARqxWoDYzzxVmQmgy+MIfV3cdafZBHzpEVwTkmNq4nzMsCfEleo3OLjAl2llaWc7C14KEMAwhcq91nj7SuhjxygowILv7e1AamsUa4VBDaXFiXd8b6j7QEF4+vWsU4uOHSQ2FBmJU32f2DlOriZSSXIHMHa6F1H/LoM5ISLMzy5SM3Cl7OHWoL5NFn2KwKnROqZNDYqzA4IBcOG+Xs+bLzNcgja1hqMA/DLhhEYMAWO8dVuSCPrJFAMJlmGOBQqC/A8GkV5JE1TCY6apqfpkMYfJALrh6tBM4cfx/yyBhmDQ6DCwah9uqQRAbt64cDsuykDQYApji4pLSqA7IgeM4tM+CBmntgclkplAwZEit/85398Oa7++H55lfg086TKWWMGTUSFsy/DRbMmwNjRo+MlVM7krPjP3vEFuswx9g4mrd+T57UgDO0GjIAB9g9RTnkzrKNH9vM2ytPcqGpMy0RDOzzKpS2hETMAbncySHUYq7LPRXK4abeOrIzDFfVUD/wHuVgsJhISJsG2m4baI0VykdKb5uJNRxYLWSIG5RDs2hv1wuuijgxciaNJ19bChvX/l7srTB96g1ie6DmXtjU9AKsfWKzZb01KxaLCWKFCPFzxEZk337fIrHXOCNyfJFavAJ/tAsyAlf62gadPBmffpnaMAgT4UsS26hIsN1UNwxst378rlxWrgFrYRTng8UdkXAGEtaRGg7Ik9wVyiGRtg0BG4sTwgVZImai0fxlNKtJa7dvfSopuUaUFF8Fv3vwF7BmeYO5HLX9jW3PJiU3HkQ21Z88oRSYpNXAIIAGfPF78uSMxkzHAXmCbAMJIxQmZ1JfA3Dvkyf2a1mKEcyYNDNdZRrojetWmswxoevcOTSju8VmZZIfqL0Xif557HzNigbLCXKh/SM481cvnGvdC6Gz50zXaLJs37oR+3CNkx58wCAAmt5niDRzaVHS/Dlq9jOQ6MD6OWgbkMzVvVbGdJd+RQ/2Xjk87aCR5saTu8nzojDBRLIOWk/XrGww1SVNpjW1pHiIMLtG9Bw/AZ/8diV0I7E6CkZfAyPqFsKI+vtiZUTyxrUr4bafLqK+tln1EQer7kal3QNZgAa3EtdnyB7OKGmz9AJal/fJk8C6b4kmFu89r1Jp99ExrvU+1Lj4HISTJlHIWqJninK4DlJAEOwsvRkfBWqp6sH0m24QGmzE2if+ZLm+Pt+yQ2gyTQgjiNh4GUTu0Z/UQQD3RtD58T+sE8dGkmltX1R/T/naFa0wGECkkRnFgc7kaRtpt0mD7cDmQtSnwElGe8sHQHuTTJp0EASHuOa0pXmuNOfWGabzrrPdSZ0nAnnRyx5tFFpnRLz2ntywMYHc+OvD7poLtuJea9Dwy4Ula1cssayPDopMXm98uR1CitErNQI95JnYxp3YhncYvd/kYKtQy7zJ5OtAFdogxXnjtJbjBKnGcje6Y7vTyTDdFVi5Vb9x2vkroxNOEGxn1h6dEeTgGEEEpsOmphdN52QF4EFznYu47qZCGNdiWpuHVFXGyuySTU7RZFX8IBJCYCdv1G3VgLTQykNF79eHu6YkbRajTuhaS6aaQqMKSAE72BsxhJobDY0MYDKS76Ea+9FMx4dVyUBypARZAgpE+yZBH9EV5wRlgjGjv51QdrH947TtAsc7TedXD7v8iTYbhLbhAG/Qz2mwD8iTH0/VhtZnjE8ryE+wdqgikw3DKA9qdQfFvtBPZExw17lu03lJ8RDIBciZSl9nlOn89JkBedGDJ9mSwgZ2N1bp0M/J3KLJnAVpQE4grtljMR6fh/G1ByJrc9y9SKsF0Uu42w197bcw0WFN80tSaq7jwx8yt+QlG73neNx+60ysc2Xs/DujEskcdudcXGc3JZVBE+AbZRNMZQc//LgLksOL5s4qX+1L1gAHuQkH25NYrqWcSaSRmLiYbwNG65XwYiTgW/AwwZnqkF1wHs7HezrbJil7vbiv2yeX1WK7h3Eba67C1rd5vM+AZb9hN7dYdvD3xPotCLZJdiWdF73j33tMiYlIEqMelv1xg2X968rGw9an1prKnmveISaEMXwaUb8QzjT/HQKfdVrKGXZXtcnBInhe9iqQBPg7tlVmGSYhuUrUg80aNyntbXvliUslYFHzzGSreqfhdEK6k4DEzxqr+GAK9hnTnDg5Q2QRTJNDg2C1lXONa3XHjcphH6RAJA4OXlDAUZSqnnCq3mjdB9+vmhIrowQGme51T26JlnBxW9LurRvXJMhYh173p52fwzJD0oPIG//8FjiyoN7kTVP5yIfuFxPACOqD95VdCuQY74+7LmEEbaFCQA1L538CeazoHN3BDfFwPNDjdcanOwlI/KxDZWW+4IUCbK4ORUoSHAy0Cl+huZat5OKksIx/0LqIfguC/WhqSsZNa0uX7Fi+ZgP8489PgrO4OFZGCQwKfQ5+eFQ4XpOvHW+ZpVqDMTOZ+XW4n46JKONEITM8ac+rIoNFDpUN5ZPXHK+5/rNnYdGyR0Fimg9yCFycGkIhnuDQhOGiAilIM4JBqB49aTLVQ62u28DmQ+1MMN1k0tULDB22kF8CWxKnSsMlR7Lw0FktyqyFZF0Cg5PFubYb0oBIvO/Xy8RAG0HJC8pRE9Hx5NI0eu5v24X26iCSPmg/kiCfSCWT7PzBbEty6d44SRT/0b2WWax+AAedy/EbF/vMQPErmvr65Nfb/JrB6+4Fk1G7GyKhHZPjr+L4NWYTG8ej92EDY95MGpCpnjG3Fj5Bc8rTGC8iZTkmO4hQI0iTZ1TXwEbPCygjtRC6TPf60cLfiHvzFM5SBDn9ni6pxCBICab0RuWgl/fGxgmgdGgk5wxpzT6In848Nuju10cAsVw0PWMtKZ3qz+STFCLo+tl3ipzzbbdMF+lDo+NEmr7j9TfgacxTp/Kyl6OD9nTTS3B/zd1i3TZqP7U72H4U/tLyT5H61CHx3sQDF7Ek22WUySGsQApYtUkGFkkYiOfCAJm9p4ah0+owhK43lkmgKfoxkYxZL08YHwfilZksMemBdTU05+zZSuWgzyiDiydR2cE0OYvHVblZH999IoLJs073gL+fcjq6jrZ+F76GoJcAKhQl5wG+iWAnvY3gKOzI+YdlOYLGoPbckdYMcsN56EhYXvqjxQOMPmnvt667mV37zQKRF7z4ZYD974O3uPHaFXjt/BcYP4SDoozZHDAchvPPA6eYrSBSL1gAvByn/McngJ084ou1H17mYqfae8+/OW4qFJYMh5P7toPL5YLDBrkBmwZL7/4hJqXc4r5aKCLcjs8BSSbJovu2t78sykdOuR16uk7Bl8feAWqzqflfLNwTocvBHfCrBS6+/qXXWCEUxn4r9aW4bBq78ophnPpASEhfnT3W6safeQAGGVgQZkMfoF7gza2KKp8+rrpUlTfTABivnT7eMzMQUF8Patp+2uj4RFApDzP1v3RMG3Sr7rbPVfk8V7cYZQeC6k7jeYhBQ3fXKXr8B1h/LF0PamGSuw+C2vpGj8+p31eXjTI367LwvhXuaFqy2/9FNcmjY2w3VFXDzbos6oeQFdDWo4ydsX4KQdpjF/1nqvU+2a0GJRLTSdh5ZhnTXWowDqv7/BEa473LDb2WFOTrZZdrieLziWuhIHzSrbTOdpZW1Woc5MgEFy8gQtex1tikoleKsR9ynHTzufjbCugi7btw9vROrF+nvyDoRMsIjvNUn/INzp4g1Knm34Rhma0ZiaN412+TJCf2Z2hZ2Y+hM/hZM+OsyX+01SNkYV8jsmxDxdgYPp6XQlc8Yvwq0zIBTXEm49IjMBjAYZc/Ouj9l8W9GHPO9R9XZ7lTJ/AFhNnEzVnugmxA2kfhHA083YdkOAqKVjscV75PhEUhZI8c74pZFCRxg+a4uAonYEzWiWBnuXDjo+QS6NiQC2B6P8W1uE9u7ck66T/2diPOOudl/qKgg4WK5kOOwBnDbFF4Pme2FqEpjpTVZd3ssQDswZHyQIZgTCrnGojEUaPHi45rUbN+6QQoSyiYKrTDZpQPuKwqWC4SJDTmaDl20gTUvaOwFpKZJCmQ9DcBmemvoqcJy1hSgiM3bHUjyZfrs5EOWndz/RE4zXznuGlCU1jqpIgSb6IhQ0hImsZZOTlaPp/o/2zUMFpnd0HQ5qeJ1ROCetVi2WE2qKdvw3g03o8+CJJJq8WygqBjGff7O1Vavpb4U/y/SUqCCQaSH4aBSBMlAnMR4CPNHagv/HVNoc9TU/0k3eyRFw2qaiqbOAL4ARxg/Zz63ROI1IGg6mWOKx5qU9SxeF2hIjWk/kzi7Cu/8rZC6ztETatkD4DRs/d/1KrQBETmHue0vh59q62kdFoJaTXW91EddBhn+kOo+RELFDPPRo9eR1qCIwOCJJdWeskJwNOxMHDgjPOl/mPvZPICW8YyrY6jmpLivSNeghonTDQPwR58XO7BQb9eL0Pdqy90ANfPMUZv0pmmhzeo8fPxZjvxukJlmIEDFuJ6rppj2814jVxvmsTzjX0TE3D81BmkVZG+8vk8xJqxvpjw0Q/KSBbHAXtMLwcLE53lv+xgNGgvWjwA2hzRWhZeOgAPEi4r9H8oyIU16ousvv1PFq5HWhhwDYOa/sgBnViAR/z5/8kaEPT7n+7AoVbjE6E7UJLLkOK0kssNR0TqHmBh79dNYwcbcuo0iU9KNCZrGCZEpY/B8y5cu7rIs0RiFcj/V2UeeeSRR4b4P6n8wLX0hHkeAAAAAElFTkSuQmCC
name: CofenseIntelligenceV2
script:
  commands:
  - arguments:
    - default: true
      description: IP address to check.
      isArray: true
      name: ip
      required: true
    - description: The maximum number of days from which to start returning data.
        90 days is recommended by Cofense.
      name: days_back
    description: Checks the reputation of an IP address.
    name: ip
    outputs:
    - contextPath: IP.ASN
      description: The autonomous system name for the IP address.
      type: Unknown
    - contextPath: IP.GEO.Location
      description: 'The geolocation where the IP address is located, in the format
        of latitude: longitude.'
      type: Unknown
    - contextPath: IP.GEO.Country
      description: The country in which the IP address is located.
      type: Unknown
    - contextPath: IP.Address
      description: IP address.
      type: Unknown
    - contextPath: IP.MalwareFamily
      description: The malware family associated with the IP address.
      type: Unknown
    - contextPath: IP.Relationships.EntityA
      description: The source of the relationship.
      type: String
    - contextPath: IP.Relationships.EntityB
      description: The destination of the relationship.
      type: String
    - contextPath: IP.Relationships.Relationship
      description: The name of the relationship.
      type: String
    - contextPath: IP.Relationships.EntityAType
      description: The type of the source of the relationship.
      type: String
    - contextPath: IP.Relationships.EntityBType
      description: The type of the destination of the relationship.
      type: String
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Type
      description: The indicator type.
      type: string
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
      type: string
    - contextPath: DBotScore.Score
      description: The actual score.
      type: number
    - contextPath: DBotScore.Reliability
      description: The actual score.
      type: string
    - contextPath: CofenseIntelligence.IP.Data
      description: The IP address.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.id
      description: Threat ID.
      type: Number
    - contextPath: CofenseIntelligence.IP.Threats.feeds.id
      description: Integer identifier for this feed.
      type: Number
    - contextPath: CofenseIntelligence.IP.Threats.feeds.permissions.WRITE
      description: True if you are allowed to submit data to this feed.
      type: Boolean
    - contextPath: CofenseIntelligence.IP.Threats.feeds.permissions.OWNER
      description: True if you are the original provider of the source data for this
        feed.
      type: Boolean
    - contextPath: CofenseIntelligence.IP.Threats.feeds.permissions.READ
      description: True if you are allowed to view data for this feed.
      type: Boolean
    - contextPath: CofenseIntelligence.IP.Threats.feeds.displayName
      description: Human readable name for this feed.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.blockSet.malwareFamily.familyName
      description: The name of the malware family.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.blockSet.malwareFamily.description
      description: Brief description of the malware family, what it does, or how it
        works.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.blockSet.impact
      description: Values borrowed from stixVocabs:ImpactRatingVocab-1.0.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.blockSet.confidence
      description: The level of confidence in the threats block.
      type: Number
    - contextPath: CofenseIntelligence.IP.Threats.blockSet.blockType
      description: Data type of the watchlist item.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.blockSet.roleDescription
      description: Description of infrastructure type.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.blockSet.role
      description: Infrastructure type.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.blockSet.infrastructureTypeSubclass.description
      description: Brief description of the infrastructure type being used.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.blockSet.data
      description: Domain name or an IP address.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.blockSet.data_1
      description: Either a domain name or an IP address.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.campaignBrandSet.totalCount
      description: Total number of individual messages associated with this brand.
      type: Number
    - contextPath: CofenseIntelligence.IP.Threats.campaignBrandSet.brand.id
      description: Numeric identifier used by Malcovery to track this brand.
      type: Number
    - contextPath: CofenseIntelligence.IP.Threats.campaignBrandSet.brand.text
      description: String identifier used by Malcovery to track this brand.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.domainSet.totalCount
      description: Total number of the instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.IP.Threats.domainSet.domain
      description: Sender domain name.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.senderEmailSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.IP.Threats.senderEmailSet.senderEmail
      description: The possibly spoofed email address used in the delivery of the
        email.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.executableSet.malwareFamily.familyName
      description: Family name of the malware.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.executableSet.malwareFamily.description
      description: The name of the malware family.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.executableSet.vendorDetections.detected
      description: Whether an executable was detected.
      type: Boolean
    - contextPath: CofenseIntelligence.IP.Threats.executableSet.vendorDetections.threatVendorName
      description: Name of the antivirus vendor.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.executableSet.fileName
      description: The file name of any file discovered during a malware infection.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.executableSet.type
      description: Description of the purpose this file serves within the malware
        infection.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.executableSet.dateEntered
      description: Date when this file was analyzed by Malcovery.
      type: Date
    - contextPath: CofenseIntelligence.IP.Threats.executableSet.severityLevel
      description: The malware infection severity level.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.executableSet.fileNameExtension
      description: The file extension.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.executableSet.md5Hex
      description: The MD5 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.executableSet.sha384Hex
      description: The SHA-384 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.executableSet.sha512Hex
      description: The SHA-512 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.executableSet.sha1Hex
      description: The SHA-1 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.executableSet.sha224Hex
      description: The SHA-224 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.executableSet.sha256Hex
      description: The SHA-256 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.executableSet.executableSubtype.description
      description: The description of the executable file.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.senderIpSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.IP.Threats.senderIpSet.ip
      description: One of possibly many IP addresses used in the delivery of the email.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.senderNameSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.IP.Threats.senderNameSet.name
      description: The friendly name of the sender of the email.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.subjectSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.IP.Threats.subjectSet.subject
      description: Email subject line.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.lastPublished
      description: Timestamp of when this campaign was most recently updated.
      type: Date
    - contextPath: CofenseIntelligence.IP.Threats.firstPublished
      description: Timestamp of when this campaign was initially published.
      type: Date
    - contextPath: CofenseIntelligence.IP.Threats.label
      description: Human readable name for this campaign.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.executiveSummary
      description: Analyst written summary of the campaign.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.hasReport
      description: Whether this campaign has a written report associated with it.
      type: Boolean
    - contextPath: CofenseIntelligence.IP.Threats.reportURL
      description: Direct URL to the human readable report for this campaign.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.apiReportURL
      description: URL to the human readable report for this campaign.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.threatDetailURL
      description: T3 report URL.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.malwareFamilySet.familyName
      description: Family name of the malware.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.malwareFamilySet.description
      description: Descriptio of the malware family set.
      type: String
    - contextPath: CofenseIntelligence.IP.Threats.threatType
      description: If malware, will have value 'malware', otherwise it is empty.
      type: String
  - arguments:
    - description: String to search.
      name: str
    - description: Maximum number of strings to search. Default is 10.
      name: limit
    - description: The maximum number of days from which to start returning data.
        90 days is recommended by Cofense.
      name: days_back
    - description: The malware family associated with a malware campaign.
      name: malware_family
    - description: The filename associated with a phishing or malware campaign.
      name: malware_file
    - description: Search the message subject associated with malware campaigns.
      name: malware_subject
    - description: |-
        A specific url to search for.

        Note: This supports exact and partial matching of urls.
      name: url
    description: Retrieves a specific threat or a list of threats based on the filter
      values provided in the command arguments.
    name: cofense-search
    outputs:
    - contextPath: CofenseIntelligence.Threats.id
      description: Threat ID.
      type: Number
    - contextPath: CofenseIntelligence.Threats.feeds.id
      description: Integer identifier for this feed.
      type: Number
    - contextPath: CofenseIntelligence.Threats.feeds.permissions.WRITE
      description: True if you are allowed to submit data to this feed.
      type: Boolean
    - contextPath: CofenseIntelligence.Threats.feeds.permissions.OWNER
      description: True if you are the original provider of the source data for this
        feed.
      type: Boolean
    - contextPath: CofenseIntelligence.Threats.feeds.permissions.READ
      description: True if you are allowed to view data for this feed.
      type: Boolean
    - contextPath: CofenseIntelligence.Threats.feeds.displayName
      description: Human readable name for this feed.
      type: String
    - contextPath: CofenseIntelligence.Threats.blockSet.malwareFamily.familyName
      description: The name of the malware family.
      type: String
    - contextPath: CofenseIntelligence.Threats.blockSet.malwareFamily.description
      description: Brief description of the malware family, what it does, or how it
        works.
      type: String
    - contextPath: CofenseIntelligence.Threats.blockSet.impact
      description: Values borrowed from stixVocabs:ImpactRatingVocab-1.0.
      type: String
    - contextPath: CofenseIntelligence.Threats.blockSet.confidence
      description: The level of confidence in the threats block.
      type: Number
    - contextPath: CofenseIntelligence.Threats.blockSet.blockType
      description: Data type of the watchlist item.
      type: String
    - contextPath: CofenseIntelligence.Threats.blockSet.roleDescription
      description: Description of infrastructure type.
      type: String
    - contextPath: CofenseIntelligence.Threats.blockSet.role
      description: Infrastructure type.
      type: String
    - contextPath: CofenseIntelligence.Threats.blockSet.infrastructureTypeSubclass.description
      description: Brief description of the infrastructure type being used.
      type: String
    - contextPath: CofenseIntelligence.Threats.blockSet.data
      description: Domain name or an IP address.
      type: String
    - contextPath: CofenseIntelligence.Threats.blockSet.data_1
      description: Either a domain name or an IP address.
      type: String
    - contextPath: CofenseIntelligence.Threats.campaignBrandSet.totalCount
      description: Total number of individual messages associated with this brand.
      type: Number
    - contextPath: CofenseIntelligence.Threats.campaignBrandSet.brand.id
      description: Numeric identifier used by Malcovery to track this brand.
      type: Number
    - contextPath: CofenseIntelligence.Threats.campaignBrandSet.brand.text
      description: String identifier used by Malcovery to track this brand.
      type: String
    - contextPath: CofenseIntelligence.Threats.domainSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.Threats.domainSet.domain
      description: Sender domain name.
      type: String
    - contextPath: CofenseIntelligence.Threats.senderEmailSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.Threats.senderEmailSet.senderEmail
      description: The possibly spoofed email address used in the delivery of the
        email.
      type: String
    - contextPath: CofenseIntelligence.Threats.executableSet.malwareFamily.familyName
      description: Family name of malware.
      type: String
    - contextPath: CofenseIntelligence.Threats.executableSet.malwareFamily.description
      description: The name of the malware family.
      type: String
    - contextPath: CofenseIntelligence.Threats.executableSet.vendorDetections.detected
      description: Whether an executable was detected.
      type: Boolean
    - contextPath: CofenseIntelligence.Threats.executableSet.vendorDetections.threatVendorName
      description: Name of the antivirus vendor.
      type: String
    - contextPath: CofenseIntelligence.Threats.executableSet.fileName
      description: The file name of any file discovered during a malware infection.
      type: String
    - contextPath: CofenseIntelligence.Threats.executableSet.type
      description: Description of the purpose this file serves within the malware
        infection.
      type: String
    - contextPath: CofenseIntelligence.Threats.executableSet.dateEntered
      description: Date when this file was analyzed by Malcovery.
      type: Date
    - contextPath: CofenseIntelligence.Threats.executableSet.severityLevel
      description: The malware infection severity level.
      type: String
    - contextPath: CofenseIntelligence.Threats.executableSet.fileNameExtension
      description: The file extension.
      type: String
    - contextPath: CofenseIntelligence.Threats.executableSet.md5Hex
      description: The MD5 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Threats.executableSet.sha384Hex
      description: The SHA-384 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Threats.executableSet.sha512Hex
      description: The SHA-512 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Threats.executableSet.sha1Hex
      description: The SHA-1 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Threats.executableSet.sha224Hex
      description: The SHA-224 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Threats.executableSet.sha256Hex
      description: The SHA-256 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Threats.executableSet.executableSubtype.description
      description: The description of the executable file.
      type: String
    - contextPath: CofenseIntelligence.Threats.senderIpSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.Threats.senderIpSet.ip
      description: One of possibly many IPs used in the delivery of the email.
      type: String
    - contextPath: CofenseIntelligence.Threats.senderNameSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.Threats.senderNameSet.name
      description: The friendly name of the sender of the email.
      type: String
    - contextPath: CofenseIntelligence.Threats.subjectSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.Threats.subjectSet.subject
      description: Email subject line.
      type: String
    - contextPath: CofenseIntelligence.Threats.lastPublished
      description: Timestamp of when this campaign was most recently updated.
      type: Date
    - contextPath: CofenseIntelligence.Threats.firstPublished
      description: Timestamp of when this campaign was initially published.
      type: Date
    - contextPath: CofenseIntelligence.Threats.label
      description: Human readable name for this campaign.
      type: String
    - contextPath: CofenseIntelligence.Threats.executiveSummary
      description: .Analyst written summary of the campaign.
      type: String
    - contextPath: CofenseIntelligence.Threats.hasReport
      description: Whether this campaign has a written report associated with it.
      type: Boolean
    - contextPath: CofenseIntelligence.Threats.reportURL
      description: Direct URL to human readable report for this campaign.
      type: String
    - contextPath: CofenseIntelligence.Threats.apiReportURL
      description: URL to human readable report for this campaign.
      type: String
    - contextPath: CofenseIntelligence.Threats.threatDetailURL
      description: T3 report URL.
      type: String
    - contextPath: CofenseIntelligence.Threats.malwareFamilySet.familyName
      description: Family name of malware.
      type: String
    - contextPath: CofenseIntelligence.Threats.malwareFamilySet.description
      description: Description of the malware family set.
      type: String
    - contextPath: CofenseIntelligence.Threats.threatType
      description: If malware, will have value 'malware', otherwise it is empty.
      type: String
  - arguments:
    - default: true
      description: The hash of the file to check.
      isArray: true
      name: file
      required: true
    - description: The maximum number of days from which to start returning data.
        90 days is recommended by Cofense.
      name: days_back
    description: Checks the reputation of a file hash.
    name: file
    outputs:
    - contextPath: File.Extension
      description: The file extension.
      type: Unknown
    - contextPath: File.MD5
      description: The MD5 hash of the file.
      type: Unknown
    - contextPath: File.sha1
      description: The SHA-1 hash of the file.
      type: String
    - contextPath: File.sha256
      description: The SHA-256 hash of the file.
      type: String
    - contextPath: File.sha512
      description: The SHA-512 hash of the file.
      type: String
    - contextPath: File.SSDeep
      description: The SSDeep hash of the file.
      type: String
    - contextPath: File.Type
      description: The file type.
      type: String
    - contextPath: File.Hashes.type
      description: The hash type.
      type: String
    - contextPath: File.Hashes.value
      description: The hash value.
      type: String
    - contextPath: File.Malicious.Description
      description: A description explaining why the file was determined to be malicious.
      type: Unknown
    - contextPath: File.Malicious.Vendor
      description: The vendor who reported the file as malicious.
      type: Unknown
    - contextPath: File.MalwareFamily
      description: The malware family associated with the file.
      type: Unknown
    - contextPath: File.Name
      description: The full file name.
      type: Unknown
    - contextPath: File.Relationships.EntityA
      description: The source of the relationship.
      type: String
    - contextPath: File.Relationships.EntityB
      description: The destination of the relationship.
      type: String
    - contextPath: File.Relationships.Relationship
      description: The name of the relationship.
      type: String
    - contextPath: File.Relationships.EntityAType
      description: The type of the source of the relationship.
      type: String
    - contextPath: File.Relationships.EntityBType
      description: The type of the destination of the relationship.
      type: String
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Type
      description: The indicator type.
      type: string
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
      type: string
    - contextPath: DBotScore.Score
      description: The actual score.
      type: number
    - contextPath: DBotScore.Reliability
      description: The actual score.
      type: string
    - contextPath: CofenseIntelligence.File.Data
      description: The file hash.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.id
      description: Threat ID.
      type: Number
    - contextPath: CofenseIntelligence.File.Threats.feeds.id
      description: Integer identifier for this feed.
      type: Number
    - contextPath: CofenseIntelligence.File.Threats.feeds.permissions.WRITE
      description: True if you are allowed to submit data to this feed.
      type: Boolean
    - contextPath: CofenseIntelligence.File.Threats.feeds.permissions.OWNER
      description: True if you are the original provider of the source data for this
        feed.
      type: Boolean
    - contextPath: CofenseIntelligence.File.Threats.feeds.permissions.READ
      description: True if you are allowed to view data for this feed.
      type: Boolean
    - contextPath: CofenseIntelligence.File.Threats.feeds.displayName
      description: Human readable name for this feed.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.blockSet.malwareFamily.familyName
      description: The name of the malware family.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.blockSet.malwareFamily.description
      description: Brief description of the malware family, what it does, or how it
        works.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.blockSet.impact
      description: Values borrowed from stixVocabs:ImpactRatingVocab-1.0.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.blockSet.confidence
      description: The level of confidence in the threats block.
      type: Number
    - contextPath: CofenseIntelligence.File.Threats.blockSet.blockType
      description: Data type of the watchlist item.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.blockSet.roleDescription
      description: Description of the infrastructure type.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.blockSet.role
      description: Infrastructure type.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.blockSet.infrastructureTypeSubclass.description
      description: Brief description of the infrastructure type being used.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.blockSet.data
      description: Domain name or an IP address.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.blockSet.data_1
      description: Either a domain name or an IP address.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.campaignBrandSet.totalCount
      description: Number of individual messages associated with this brand.
      type: Number
    - contextPath: CofenseIntelligence.File.Threats.campaignBrandSet.brand.id
      description: Numeric identifier used by Malcovery to track this brand.
      type: Number
    - contextPath: CofenseIntelligence.File.Threats.campaignBrandSet.brand.text
      description: String identifier used by Malcovery to track this brand.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.domainSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.File.Threats.domainSet.domain
      description: Sender domain name.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.senderEmailSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.File.Threats.senderEmailSet.senderEmail
      description: The possibly spoofed email address used in the delivery of the
        email.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.executableSet.malwareFamily.familyName
      description: Family name of malware.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.executableSet.malwareFamily.description
      description: The name of the malware family.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.executableSet.vendorDetections.detected
      description: Whether an executable was detected.
      type: Boolean
    - contextPath: CofenseIntelligence.File.Threats.executableSet.vendorDetections.threatVendorName
      description: Name of the antivirus vendor.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.executableSet.fileName
      description: The file name of any file discovered during a malware infection.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.executableSet.type
      description: Description of the purpose this file serves within the malware
        infection.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.executableSet.ssdeep
      description: The ssdeep hash of the file.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.executableSet.dateEntered
      description: Date when this file was analyzed by Malcovery.
      type: Date
    - contextPath: CofenseIntelligence.File.Threats.executableSet.severityLevel
      description: The malware infection severity level.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.executableSet.fileNameExtension
      description: The file extension.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.executableSet.md5Hex
      description: The MD5 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.executableSet.sha384Hex
      description: The SHA-384 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.executableSet.sha512Hex
      description: The SHA-512 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.executableSet.sha1Hex
      description: The SHA-1 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.executableSet.sha224Hex
      description: The SHA-224 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.executableSet.sha256Hex
      description: The SHA-256 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.executableSet.executableSubtype.description
      description: The description of the executable file.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.senderIpSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.File.Threats.senderIpSet.ip
      description: One of possibly many IPs used in the delivery of the email.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.senderNameSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.File.Threats.senderNameSet.name
      description: The friendly name of the sender of the email.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.subjectSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.File.Threats.subjectSet.subject
      description: Email subject line.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.lastPublished
      description: Timestamp of when this campaign was most recently updated.
      type: Date
    - contextPath: CofenseIntelligence.File.Threats.firstPublished
      description: Timestamp of when this campaign was initially published.
      type: Date
    - contextPath: CofenseIntelligence.File.Threats.label
      description: Human readable name for this campaign.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.executiveSummary
      description: Analyst written summary of the campaign.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.hasReport
      description: Whether this campaign has a written report associated with it.
      type: Boolean
    - contextPath: CofenseIntelligence.File.Threats.reportURL
      description: Direct URL to human readable report for this campaign.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.apiReportURL
      description: URL to human readable report for this campaign.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.threatDetailURL
      description: T3 report URL.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.malwareFamilySet.familyName
      description: Family name of the malware.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.malwareFamilySet.description
      description: Description of the malware family set.
      type: String
    - contextPath: CofenseIntelligence.File.Threats.threatType
      description: If malware, will have value 'malware', otherwise it is empty.
      type: String
  - arguments:
    - default: true
      description: Sender email address to check.
      isArray: true
      name: email
      required: true
    - description: The maximum number of days from which to start returning data.
        90 days is recommended by Cofense.
      name: days_back
    description: Checks the reputation of an email address.
    name: email
    outputs:
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Type
      description: The indicator type.
      type: string
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
      type: string
    - contextPath: DBotScore.Score
      description: The actual score.
      type: number
    - contextPath: DBotScore.Reliability
      description: The actual score.
      type: string
    - contextPath: Email.Relationships.EntityA
      description: The source of the relationship.
      type: String
    - contextPath: Email.Relationships.EntityB
      description: The destination of the relationship.
      type: String
    - contextPath: Email.Relationships.Relationship
      description: The name of the relationship.
      type: String
    - contextPath: Email.Relationships.EntityAType
      description: The type of the source of the relationship.
      type: String
    - contextPath: Email.Relationships.EntityBType
      description: The type of the destination of the relationship.
      type: String
    - contextPath: CofenseIntelligence.Email.Data
      description: The email address.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.id
      description: Threat ID.
      type: Number
    - contextPath: CofenseIntelligence.Email.Threats.feeds.id
      description: Integer identifier for this feed.
      type: Number
    - contextPath: CofenseIntelligence.Email.Threats.feeds.permissions.WRITE
      description: True if you are allowed to submit data to this feed.
      type: Boolean
    - contextPath: CofenseIntelligence.Email.Threats.feeds.permissions.OWNER
      description: True if you are the original provider of the source data for this
        feed.
      type: Boolean
    - contextPath: CofenseIntelligence.Email.Threats.feeds.permissions.READ
      description: True if you are allowed to view data for this feed.
      type: Boolean
    - contextPath: CofenseIntelligence.Email.Threats.feeds.displayName
      description: Human readable name for this feed.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.blockSet.malwareFamily.familyName
      description: Names and describes the malware families.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.blockSet.malwareFamily.description
      description: Brief description of the malware family, what it does, or how it
        works.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.blockSet.impact
      description: Values borrowed from stixVocabs:ImpactRatingVocab-1.0.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.blockSet.confidence
      description: The level of confidence in the threats block.
      type: Number
    - contextPath: CofenseIntelligence.Email.Threats.blockSet.blockType
      description: Data type of the watchlist item.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.blockSet.roleDescription
      description: Description of the infrastructure type.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.blockSet.role
      description: Infrastructure type.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.blockSet.infrastructureTypeSubclass.description
      description: Brief description of the infrastructure type being used.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.blockSet.data
      description: Domain name or an IP address.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.blockSet.data_1
      description: Either a domain name or an IP address.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.campaignBrandSet.totalCount
      description: Total number of individual messages associated with this brand.
      type: Number
    - contextPath: CofenseIntelligence.Email.Threats.campaignBrandSet.brand.id
      description: Numeric identifier used by Malcovery to track this brand.
      type: Number
    - contextPath: CofenseIntelligence.Email.Threats.campaignBrandSet.brand.text
      description: String identifier used by Malcovery to track this brand.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.domainSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.Email.Threats.domainSet.domain
      description: Sender domain name.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.senderEmailSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.Email.Threats.senderEmailSet.senderEmail
      description: The possibly spoofed email address used in the delivery of the
        email.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.executableSet.malwareFamily.familyName
      description: Family name of the malware.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.executableSet.malwareFamily.description
      description: The name of the malware family.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.executableSet.vendorDetections.detected
      description: Whether an executable was detected.
      type: Boolean
    - contextPath: CofenseIntelligence.Email.Threats.executableSet.vendorDetections.threatVendorName
      description: Name of the antivirus vendor.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.executableSet.fileName
      description: The file name of any file discovered during a malware infection.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.executableSet.type
      description: Description of the purpose this file serves within the malware
        infection.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.executableSet.dateEntered
      description: Date when this file was analyzed by Malcovery.
      type: Date
    - contextPath: CofenseIntelligence.Email.Threats.executableSet.severityLevel
      description: The malware infection severity level.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.executableSet.fileNameExtension
      description: The file extension.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.executableSet.md5Hex
      description: The MD5 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.executableSet.sha384Hex
      description: The SHA-384 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.executableSet.sha512Hex
      description: The SHA-512 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.executableSet.sha1Hex
      description: The SHA-1 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.executableSet.sha224Hex
      description: The SHA-224 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.executableSet.sha256Hex
      description: The SHA-256 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.executableSet.executableSubtype.description
      description: The description of the executable file.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.senderIpSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.Email.Threats.senderIpSet.ip
      description: One of possibly many IPs used in the delivery of the email.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.senderNameSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.Email.Threats.senderNameSet.name
      description: The friendly name of the sender of the email.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.subjectSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.Email.Threats.subjectSet.subject
      description: Email subject line.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.lastPublished
      description: Timestamp of when this campaign was most recently updated.
      type: Date
    - contextPath: CofenseIntelligence.Email.Threats.firstPublished
      description: Timestamp of when this campaign was initially published.
      type: Date
    - contextPath: CofenseIntelligence.Email.Threats.label
      description: Human readable name for this campaign.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.executiveSummary
      description: Analyst written summary of the campaign.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.hasReport
      description: Whether this campaign has a written report associated with it.
      type: Boolean
    - contextPath: CofenseIntelligence.Email.Threats.reportURL
      description: Direct URL to human readable report for this campaign.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.apiReportURL
      description: URL to human readable report for this campaign.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.threatDetailURL
      description: T3 report URL.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.malwareFamilySet.familyName
      description: Family name of the malware.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.malwareFamilySet.description
      description: Description of the malware family set.
      type: String
    - contextPath: CofenseIntelligence.Email.Threats.threatType
      description: If malware, will have value 'malware', otherwise it is empty.
      type: String
  - arguments:
    - default: true
      description: URL to check.
      isArray: true
      name: url
      required: true
    - description: The maximum number of days from which to start returning data.
        90 days is recommended by Cofense.
      name: days_back
    description: Checks the reputation of a URL.
    name: url
    outputs:
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Type
      description: The indicator type.
      type: string
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
      type: string
    - contextPath: DBotScore.Score
      description: The actual score.
      type: number
    - contextPath: DBotScore.Reliability
      description: The actual score.
      type: string
    - contextPath: URL.Data
      description: The URL.
      type: string
    - contextPath: URL.Malicious.Description
      description: A description of the malicious URL.
      type: string
    - contextPath: URL.Malicious.Vendor
      description: The vendor who reported the URL as malicious.
      type: string
    - contextPath: URL.Relationships.EntityA
      description: The source of the relationship.
      type: String
    - contextPath: URL.Relationships.EntityB
      description: The destination of the relationship.
      type: String
    - contextPath: URL.Relationships.Relationship
      description: The name of the relationship.
      type: String
    - contextPath: URL.Relationships.EntityAType
      description: The type of the source of the relationship.
      type: String
    - contextPath: URL.Relationships.EntityBType
      description: The type of the destination of the relationship.
      type: String
    - contextPath: CofenseIntelligence.URL.Data
      description: The URL.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.id
      description: Threat ID.
      type: Number
    - contextPath: CofenseIntelligence.URL.Threats.feeds.id
      description: Integer identifier for this feed.
      type: Number
    - contextPath: CofenseIntelligence.URL.Threats.feeds.permissions.WRITE
      description: True if you are allowed to submit data to this feed.
      type: Boolean
    - contextPath: CofenseIntelligence.URL.Threats.feeds.permissions.OWNER
      description: True if you are the original provider of the source data for this
        feed.
      type: Boolean
    - contextPath: CofenseIntelligence.URL.Threats.feeds.permissions.READ
      description: True if you are allowed to view data for this feed.
      type: Boolean
    - contextPath: CofenseIntelligence.URL.Threats.feeds.displayName
      description: Human readable name for this feed.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.blockSet.malwareFamily.familyName
      description: The name of the malware family.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.blockSet.malwareFamily.description
      description: Brief description of the malware family, what it does, or how it
        works.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.blockSet.impact
      description: Values borrowed from stixVocabs:ImpactRatingVocab-1.0.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.blockSet.confidence
      description: The level of confidence in the threats block.
      type: Number
    - contextPath: CofenseIntelligence.URL.Threats.blockSet.blockType
      description: Data type of the watchlist item.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.blockSet.roleDescription
      description: Description of the infrastructure type.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.blockSet.role
      description: Infrastructure type.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.blockSet.infrastructureTypeSubclass.description
      description: Brief description of the infrastructure type being used.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.blockSet.data
      description: Domain name or an IP address.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.blockSet.data_1
      description: Either a domain name or an IP address.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.campaignBrandSet.totalCount
      description: Total number of individual messages associated with this brand.
      type: Number
    - contextPath: CofenseIntelligence.URL.Threats.campaignBrandSet.brand.id
      description: Numeric identifier used by Malcovery to track this brand.
      type: Number
    - contextPath: CofenseIntelligence.URL.Threats.campaignBrandSet.brand.text
      description: String identifier used by Malcovery to track this brand.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.domainSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.URL.Threats.domainSet.domain
      description: Sender domain name.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.senderEmailSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.URL.Threats.senderEmailSet.senderEmail
      description: The possibly spoofed email address used in the delivery of the
        email.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.executableSet.malwareFamily.familyName
      description: Family name of the malware.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.executableSet.malwareFamily.description
      description: The name of the malware family.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.executableSet.vendorDetections.detected
      description: Whether an executable was detected.
      type: Boolean
    - contextPath: CofenseIntelligence.URL.Threats.executableSet.vendorDetections.threatVendorName
      description: Name of the antivirus vendor.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.executableSet.fileName
      description: The file name of any file discovered during a malware infection.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.executableSet.type
      description: Description of the purpose this file serves within the malware
        infection.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.executableSet.dateEntered
      description: Date when this file was analyzed by Malcovery.
      type: Date
    - contextPath: CofenseIntelligence.URL.Threats.executableSet.severityLevel
      description: The malware infection severity level.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.executableSet.fileNameExtension
      description: The file extension.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.executableSet.md5Hex
      description: The MD5 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.executableSet.sha384Hex
      description: The SHA-384 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.executableSet.sha512Hex
      description: The SHA-512 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.executableSet.sha1Hex
      description: The SHA-1 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.executableSet.sha224Hex
      description: The SHA-224 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.executableSet.sha256Hex
      description: The SHA-256 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.executableSet.executableSubtype.description
      description: The description of the executable file.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.senderIpSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.URL.Threats.senderIpSet.ip
      description: One of possibly many IPs used in the delivery of the email.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.senderNameSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.URL.Threats.senderNameSet.name
      description: The friendly name of the sender of the email.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.subjectSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.URL.Threats.subjectSet.subject
      description: Email subject line.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.lastPublished
      description: Timestamp of when this campaign was most recently updated.
      type: Date
    - contextPath: CofenseIntelligence.URL.Threats.firstPublished
      description: Timestamp of when this campaign was initially published.
      type: Date
    - contextPath: CofenseIntelligence.URL.Threats.label
      description: Human readable name for this campaign.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.executiveSummary
      description: Analyst written summary of the campaign.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.hasReport
      description: Whether this campaign has a written report associated with it.
      type: Boolean
    - contextPath: CofenseIntelligence.URL.Threats.reportURL
      description: Direct URL to human readable report for this campaign.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.apiReportURL
      description: URL to human readable report for this campaign.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.threatDetailURL
      description: T3 report URL.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.malwareFamilySet.familyName
      description: Family name of the malware.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.malwareFamilySet.description
      description: Description of the malware family set.
      type: String
    - contextPath: CofenseIntelligence.URL.Threats.threatType
      description: If malware, will have value 'malware', otherwise it is empty.
      type: String
  - arguments:
    - default: true
      description: Domain to check.
      isArray: true
      name: domain
      required: true
    - description: The maximum number of days from which to start returning data.
        90 days is recommended by Cofense.
      name: days_back
    description: Checks the reputation of the domain.
    name: domain
    outputs:
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: String
    - contextPath: DBotScore.Type
      description: The indicator type.
      type: String
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
      type: String
    - contextPath: DBotScore.Score
      description: The actual score.
      type: Number
    - contextPath: DBotScore.Reliability
      description: The actual score.
      type: String
    - contextPath: Domain.Name
      description: The Domain.
      type: String
    - contextPath: Domain.Malicious.Description
      description: A description of the malicious URL.
      type: String
    - contextPath: Domain.Malicious.Vendor
      description: The vendor who reported the Domain as malicious.
      type: String
    - contextPath: Domain.Relationships.EntityA
      description: The source of the relationship.
      type: String
    - contextPath: Domain.Relationships.EntityB
      description: The destination of the relationship.
      type: String
    - contextPath: Domain.Relationships.Relationship
      description: The name of the relationship.
      type: String
    - contextPath: Domain.Relationships.EntityAType
      description: The type of the source of the relationship.
      type: String
    - contextPath: Domain.Relationships.EntityBType
      description: The type of the destination of the relationship.
      type: String
    - contextPath: CofenseIntelligence.Domain.Data
      description: The Domain.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.id
      description: Threat ID.
      type: Number
    - contextPath: CofenseIntelligence.Domain.Threats.feeds.id
      description: Integer identifier for this feed.
      type: Number
    - contextPath: CofenseIntelligence.Domain.Threats.feeds.permissions.WRITE
      description: True if you are allowed to submit data to this feed.
      type: Boolean
    - contextPath: CofenseIntelligence.Domain.Threats.feeds.permissions.OWNER
      description: True if you are the original provider of the source data for this
        feed.
      type: Boolean
    - contextPath: CofenseIntelligence.Domain.Threats.feeds.permissions.READ
      description: True if you are allowed to view data for this feed.
      type: Boolean
    - contextPath: CofenseIntelligence.Domain.Threats.feeds.displayName
      description: Human readable name for this feed.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.blockSet.malwareFamily.familyName
      description: The name of the malware family.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.blockSet.malwareFamily.description
      description: Brief description of the malware family, what it does, or how it
        works.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.blockSet.impact
      description: Values borrowed from stixVocabs:ImpactRatingVocab-1.0.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.blockSet.confidence
      description: The level of confidence in the threats block.
      type: Number
    - contextPath: CofenseIntelligence.Domain.Threats.blockSet.blockType
      description: Data type of the watchlist item.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.blockSet.roleDescription
      description: Description of the infrastructure type.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.blockSet.role
      description: Infrastructure type.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.blockSet.infrastructureTypeSubclass.description
      description: Brief description of the infrastructure type being used.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.blockSet.data
      description: Domain name or an IP address.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.blockSet.data_1
      description: Either a domain name or an IP address.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.campaignBrandSet.totalCount
      description: Total number of individual messages associated with this brand.
      type: Number
    - contextPath: CofenseIntelligence.Domain.Threats.campaignBrandSet.brand.id
      description: Numeric identifier used by Malcovery to track this brand.
      type: Number
    - contextPath: CofenseIntelligence.Domain.Threats.campaignBrandSet.brand.text
      description: String identifier used by Malcovery to track this brand.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.domainSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.Domain.Threats.domainSet.domain
      description: Sender domain name.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.senderEmailSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.Domain.Threats.senderEmailSet.senderEmail
      description: The possibly spoofed email address used in the delivery of the
        email.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.executableSet.malwareFamily.familyName
      description: Family name of the malware.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.executableSet.malwareFamily.description
      description: The name of the malware family.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.executableSet.vendorDetections.detected
      description: Whether an executable was detected.
      type: Boolean
    - contextPath: CofenseIntelligence.Domain.Threats.executableSet.vendorDetections.threatVendorName
      description: Name of the antivirus vendor.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.executableSet.fileName
      description: The file name of any file discovered during a malware infection.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.executableSet.type
      description: Description of the purpose this file serves within the malware
        infection.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.executableSet.dateEntered
      description: Date when this file was analyzed by Malcovery.
      type: Date
    - contextPath: CofenseIntelligence.Domain.Threats.executableSet.severityLevel
      description: The malware infection severity level.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.executableSet.fileNameExtension
      description: The file extension.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.executableSet.md5Hex
      description: The MD5 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.executableSet.sha384Hex
      description: The SHA-384 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.executableSet.sha512Hex
      description: The SHA-512 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.executableSet.sha1Hex
      description: The SHA-1 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.executableSet.sha224Hex
      description: The SHA-224 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.executableSet.sha256Hex
      description: The SHA-256 hash of the file.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.executableSet.executableSubtype.description
      description: The description of the executable file.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.senderIpSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.Domain.Threats.senderIpSet.ip
      description: One of possibly many IPs used in the delivery of the email.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.senderNameSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.Domain.Threats.senderNameSet.name
      description: The friendly name of the sender of the email.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.subjectSet.totalCount
      description: Total number of instances of each item named.
      type: Number
    - contextPath: CofenseIntelligence.Domain.Threats.subjectSet.subject
      description: Email subject line.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.lastPublished
      description: Timestamp of when this campaign was most recently updated.
      type: Date
    - contextPath: CofenseIntelligence.Domain.Threats.firstPublished
      description: Timestamp of when this campaign was initially published.
      type: Date
    - contextPath: CofenseIntelligence.Domain.Threats.label
      description: Human readable name for this campaign.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.executiveSummary
      description: Analyst written summary of the campaign.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.hasReport
      description: Whether this campaign has a written report associated with it.
      type: Boolean
    - contextPath: CofenseIntelligence.Domain.Threats.reportDomain
      description: Direct URL to human readable report for this campaign.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.apiReportURL
      description: URL to human readable report for this campaign.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.threatDetailURL
      description: T3 report URL.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.malwareFamilySet.familyName
      description: Family name of the malware.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.malwareFamilySet.description
      description: Description of the malware family set.
      type: String
    - contextPath: CofenseIntelligence.Domain.Threats.threatType
      description: If malware, will have value 'malware', otherwise it is empty.
      type: String
  - arguments:
    - description: Unique id to download the specified threat report.
      name: report_id
      required: true
    - auto: PREDEFINED
      default: true
      defaultValue: html
      description: |-
        Report format to download.
        Allowed types are html and pdf.
      name: report_format
      predefined:
      - html
      - pdf
    description: Downloads threat report provided by cofense intelligence of an indicator
      for the given unique report id.
    name: cofense-threat-report-get
    outputs:
    - contextPath: File.Size
      description: The size of the file.
      type: Number
    - contextPath: File.SHA1
      description: The SHA1 hash of the file.
      type: String
    - contextPath: File.SHA256
      description: The SHA256 hash of the file.
      type: String
    - contextPath: File.SHA512
      description: The SHA512 hash of the file.
      type: String
    - contextPath: File.Name
      description: The name of the file.
      type: String
    - contextPath: File.SSDeep
      description: The SSDeep hash of the file.
      type: String
    - contextPath: File.EntryID
      description: The entry ID of the file.
      type: String
    - contextPath: File.Info
      description: File information.
      type: String
    - contextPath: File.Type
      description: The file type.
      type: String
    - contextPath: File.MD5
      description: The MD5 hash of the file.
      type: String
    - contextPath: File.Extension
      description: The file extension.
      type: String
  dockerimage: demisto/python3:3.10.13.84405
  runonce: false
  script: |
    register_module_line('CofenseIntelligenceV2', 'start', __line__())
    ### pack version: 1.1.15
    """Main integration script."""
    import base64
    import traceback
    from typing import Any, Dict, List

    import urllib3
    from requests import Response



    # Disable insecure warnings
    urllib3.disable_warnings()  # noqa # pylint: disable=no-member

    ''' CONSTANTS '''

    DATE_FORMAT = '%Y-%m-%dT%H:%M:%SZ'  # ISO8601 format with UTC, default in XSOAR
    VENDOR_NAME = "Cofense Intelligence v2"
    INTEGRATION_NAME = "CofenseIntelligenceV2"
    OUTPUT_PREFIX = 'CofenseIntelligence'
    RELIABILITY = 'integration_reliability'

    DBOT_TO_VERDICT = {0: 'Unknown', 1: 'Benign', 2: 'Suspicious', 3: 'Malicious'}

    EMAIL_REGEX = r'[^@]+@[^@]+\.[^@]+'
    BRAND = "Cofense Intelligence"
    BLOCK_TYPE_MAPPING = {
        "ip": "IPv4 Address",
        "domain": "Domain Name",
        "email": "Email",
        "url": "URL",
    }


    class Client(BaseClient):
        """Client class to interact with the service API.

        This Client implements API calls, and does not contain any XSOAR logic.
        Should only do requests and return data.
        It inherits from BaseClient defined in CommonServer Python.
        Most calls use _http_request() that handles proxy, SSL verification, etc.
        For this  implementation, no special attributes defined
        """

        def __init__(self, base_url, headers, verify, proxy, score_mapping, create_relationships=True):
            """Construct object for class Client."""
            super().__init__(base_url=base_url, headers=headers, verify=verify, proxy=proxy)
            self.create_relationships = create_relationships
            self.severity_score = self.score_mapping(score_mapping)

        @staticmethod
        def score_mapping(score_mapping):
            """
            Update the SEVERITY_SCORE according to the score_mapping provided by user.

            :param score_mapping: custom score mapping provided by user.
            """
            severity_score = {'None': 0, 'Minor': 1, 'Moderate': 2, 'Major': 3}
            if score_mapping:
                mappings = [mapping.strip() for mapping in score_mapping.split(",") if mapping.strip()]
                for mapping in mappings:
                    if mapping:
                        attr = [score.strip() for score in mapping.split(":") if score.strip()]
                        if len(attr) == 2 and attr[0] in severity_score.keys():
                            severity_score[attr[0]] = int(attr[1])

            return severity_score

        def threat_search_call(self, days_back=90, ip=None, file=None, email=None, url=None, string=None, domain=None):
            """
            Perform the API call to the threats-search endpoint with the requested query param.

            Args:
                - days_back (string): search for data not older then 'days_back' days
                - ip (string): search for threats associated with this ip address
                - file (string): search for threats associated with this file hash
                - email (string): search for threats associated with this email address
                - url (string): search for threats associated with this url
                - string (string): search for threats related to  this string
            return:
             Json: The response returned from the API call
            """
            params = {'beginTimestamp': get_n_days_back_epoch(int(days_back))}
            if ip:
                params['ip'] = ip

            elif email:
                params['watchListEmail'] = email

            elif file:
                params['allHash'] = file

            elif url:
                params['urlSearch'] = url

            elif string:
                params['extractedString'] = string

            elif domain:
                params['domain'] = domain

            return self._http_request(method='POST', url_suffix='/apiv1/threat/search', params=params)

        def search_cofense(self, params: Dict) -> Dict:
            """
            Perform the API call to the threats-search endpoint with the requested query param.

            Args:
                - params (dict): Query Parameters to be passed.
            return:
             Json: The response returned from the API call
            """
            return self._http_request(method='POST', url_suffix='/apiv1/threat/search', params=params)

        def get_threat_report(self, report_id: str, report_format: str):
            """
            Perform the API call to get the threat report based on the report_id provided.

            Args:
                - report_id (str): id of the threat report to download.
                - report_format (str): format of the threat report to download.
            return:
             Json: The response returned from the API call
            """
            return self._http_request(method='GET', url_suffix=f'apiv1/t3/malware/{report_id}/{report_format}',
                                      resp_type='response', error_handler=error_handler)


    def error_handler(response: Response):
        """
        Error Handler function.

        Args:
             response(Response): Response object from API.
        """
        err_msg = ''
        if response.status_code == 500:
            err_msg += 'No threat report found for given report_id.'
        raise DemistoException(err_msg, res=response)


    def remove_false_vendors_detections_from_threat(threats):
        """
        Remove from report vendor detections fields that are equal to false as they are not relevant.

        Args:
            - threats (Array): threats reports from cofense raw response
        """
        for threat in threats:
            for exe in threat.get('executableSet', []):
                detections = []
                for detection in exe.get('vendorDetections', []):
                    if detection.get('detected'):
                        detections.append(detection)
                exe['vendorDetections'] = detections


    def get_n_days_back_epoch(days_back: int):
        """
        Calculate timestamp of given number of days back than today.

        Args:
            - days_back (int): Number of days before today
        """
        today = datetime.now()
        d = timedelta(days=days_back)
        return int((today - d).timestamp())


    def create_threat_md_row(threat: Dict, severity_level: int = None):
        """
        Generate dict representing a single row in the human readable markdown format.

        Args:
            - threat (Dict): threat data from cofense raw response
            - sevirity_level (int): threat severity level fot dbot score
        return:
         Dict: single row in the human  readable markdown format
        """
        threat_row = {"Threat ID": threat.get("id", ""),
                      "Threat Type": threat.get("threatType", ""),
                      "Executive Summary": threat.get("executiveSummary", ""),
                      "Campaign": threat.get("label", ""),
                      "Malware Family Description": "\n".join(
                          [m.get("description", "") for m in threat.get("malwareFamilySet", [])]),
                      "Last Published": epochToTimestamp(threat.get("lastPublished")),
                      "Threat Report": f"[{threat.get('reportURL', '')}]({threat.get('reportURL', '')})"}

        if severity_level:
            threat_row["Verdict"] = DBOT_TO_VERDICT.get(severity_level)

        return threat_row


    def create_hr_for_cofense_search(threat: Dict):
        """
        Generate dict representing a single row in the human readable markdown format.

        Args:
            - threat (Dict): threat data from cofense raw response

        return:
         Dict: single row in the human  readable markdown format
        """
        threat_row = {"Threat ID": threat.get("id", ""),
                      "Threat Type": threat.get("threatType", ""),
                      "Executive Summary": threat.get("executiveSummary", ""),
                      "Campaign": threat.get("label", ""),
                      "Malware Family": "\n".join(
                          [m.get("familyName", "") for m in threat.get("malwareFamilySet", [])]),
                      "Malware File": "\n".join(
                          [m.get("fileName", "") for m in threat.get("executableSet", [])]),
                      "Malware Subject": "\n".join(
                          [m.get("subject", "") for m in threat.get("subjectSet", [])]),
                      "Malware Family Description": "\n".join(
                          [m.get("description", "") for m in threat.get("malwareFamilySet", [])]),
                      "Last Published": epochToTimestamp(threat.get("lastPublished")),
                      "Threat Report": f"[{threat.get('reportURL', '')}]({threat.get('reportURL', '')})"}

        return threat_row


    def extract_indicator_from_block(block: dict, command: str) -> str:
        """Extract indicator from a block based on what command is being called.

        Args:
            block (dict): block from blockSet
            command (str): the name of the command

        Returns:
            str: the value of the indicator
        """
        if command == "url":
            try:
                data = block.get("data_1", {}).get("url")
            except AttributeError:
                data = block.get("data_1")
        else:
            data = block.get("data_1")

        return data


    def threats_analysis(severity_score: dict, threats: List, indicator: str, threshold: str, command: str):
        """
        Process raw response data and generate dbot score and human readable results.

        Args:
            - severity_score(dict): severity score mapping
            - threats (list): threats data from cofense raw response
            - indicator (string): threat severity level for dbot score calculation
            - threshold (string): threshold for threat's severity
            - command (string): name of the command
        return:
         Dict: represents human readable markdown table
         int: dbot score
        """
        block_type: str = BLOCK_TYPE_MAPPING.get(command, "")
        threshold_score = severity_score.get(threshold, -1)
        if threshold_score < 0 or threshold_score > 3:
            raise Exception(
                f'Cofense error: Invalid threshold value: {threshold}. Valid values are: None, Minor, Moderate or Major')

        md_data: list[dict] = []
        dbot_score = 0  # To maintain the dbot score across all threats

        # Iterating over threats
        for threat in threats:
            severity_level = 0  # To maintain severity throughout a threat
            indicator_found = False

            # Iterating over blocks in blockSet
            for block in threat.get("blockSet", {}):
                # Extracting the indicator from the block based on what command is being called
                data_1_content = extract_indicator_from_block(block, command)

                if block.get("blockType") == block_type and data_1_content == indicator and block.get("impact"):
                    indicator_found = True
                    threat_score = severity_score.get(block.get("impact"), 0)
                    adjusted_score = 3 if threshold_score <= threat_score else threat_score
                    # Setting the maximum severity from last known and current severity
                    severity_level = max(severity_level, adjusted_score)

            # If an indicator found in block sets, create a new row and update dbot score
            if indicator_found:
                dbot_score = max(dbot_score, severity_level)
                md_data.append(create_threat_md_row(threat, severity_level))

        return md_data, dbot_score


    def ip_threats_analysis(severity_score, threats: List, ip: str, threshold: str, dbot_score_obj):
        """
        Process raw response data and generate dbot score ,human readable results, ip indicator object.

        Args:
            - threats (list): threats data from cofense raw response
            - indicator (string): threat severity level for dbot score calculation
            - threshold (string): threshold for threat's severity
        return:
         Dict: represents human readable markdown table
         int: dbot score
         ip indicator : indicator object with the data collected from the threats
        """
        block_type = BLOCK_TYPE_MAPPING.get("ip")
        threshold_score = severity_score.get(threshold, -1)
        if threshold_score < 0 or threshold_score > 3:
            raise Exception(
                f'Cofense error: Invalid threshold value: {threshold}. Valid values are: None, Minor, Moderate or Major')

        md_data = []
        dbot_score = 0
        ip_indicator = Common.IP(ip=ip, dbot_score=dbot_score_obj)
        for threat in threats:
            severity_level = 0
            indicator_found = False
            for block in threat.get('blockSet', {}):
                data_1_content = extract_indicator_from_block(block, command="ip")
                if block.get("blockType") == block_type and data_1_content == ip and block.get("impact"):
                    indicator_found = True
                    threat_score = severity_score.get(block.get('impact'), 0)
                    adjusted_score = 3 if threshold_score <= threat_score else threat_score
                    severity_level = max(severity_level, adjusted_score)
                    if block.get('ipDetail') and block.get('ipDetail').get('ip') == ip:
                        ip_indicator.asn = block.get('ipDetail').get('asn')
                        ip_indicator.geo_latitude = block.get("ipDetail").get("latitude")
                        ip_indicator.geo_longitude = block.get("ipDetail").get("longitude")
                        ip_indicator.geo_country = block.get("ipDetail").get("countryIsoCode")
                        ip_indicator.malware_family = block.get('malwareFamily', {}).get('familyName')

            if indicator_found:
                dbot_score = max(dbot_score, severity_level)
                threat_md_row = create_threat_md_row(threat, severity_level)
                threat_md_row["ASN"] = ip_indicator.asn
                threat_md_row["Country"] = ip_indicator.geo_country
                md_data.append(threat_md_row)

        return md_data, dbot_score, ip_indicator


    def file_threats_analysis(severity_score, threats: List, file: str, threshold: str, dbot_score_obj):
        """
        Process raw response data and generate dbot score ,human readable results, file indicator object.

        Args:
            - threats (list): threats data from cofense raw response
            - indicator (string): threat severity level for dbot score calculation
            - threshold (string): threshold for threat's severity
        return:
         Dict: represents human readable markdown table
         int: dbot score
         file indicator : indicator object with the data collected from the threats
        """
        threshold_score = severity_score.get(threshold, -1)
        if threshold_score < 0 or threshold_score > 3:
            raise Exception(
                f'Cofense error: Invalid threshold value: {threshold}. Valid values are: None, Minor, Moderate or Major')

        file_data = []
        dbot_score = 0

        file_indicator = Common.File(dbot_score=dbot_score_obj)
        for threat in threats:
            severity_level = 0
            indicator_found = False
            for es in threat.get('executableSet', {}):
                for es_key, es_value in es.items():
                    if 'Hex' in es_key and isinstance(es_value, str) and es_value.lower() == file.lower():
                        indicator_found = True
                        threat_score = severity_score.get(es.get('severityLevel'), 0)
                        adjusted_score = 3 if threshold_score <= threat_score else threat_score
                        severity_level = max(severity_level, adjusted_score)

                        file_indicator.file_type = es.get('type')
                        file_indicator.ssdeep = es.get('ssdeep')
                        file_indicator.md5 = es.get('md5Hex')
                        file_indicator.sha512 = es.get('sha512Hex')
                        file_indicator.sha1 = es.get('sha1Hex')
                        file_indicator.sha256 = es.get('sha256Hex')
                        file_indicator.name = es.get('fileName')
                        file_indicator.malware_family = es.get('malwareFamily', {}).get('familyName')
                        file_indicator.extension = es.get('fileNameExtension')
            if indicator_found:
                dbot_score = max(dbot_score, severity_level)
                threat_md_row = create_threat_md_row(threat, severity_level)
                file_data.append(threat_md_row)

        return file_data, dbot_score, file_indicator


    def check_indicator_type(indicator_value) -> str:
        """
        Infer the type of the indicator.

        :type indicator_value: ``str``
        :param indicator_value: The indicator whose type we want to check. (required)

        :return: The type of the indicator.
        :rtype: ``str``
        """
        domainRegex = r'/.+\/\/|www.|\..+/g'

        if re.match(domainRegex, indicator_value):
            return FeedIndicatorType.Domain
        else:
            return auto_detect_indicator_type(indicator_value)


    def create_relationship(client: Client, indicator: str, threats: List, entity_a_type: str) -> List:
        """
        Create relationships between indicators as part of enrichment.

        :param entity_a_type:
        :type client: ``Client``
        :param client: client instance that is responsible for connecting with cofense API

        :type indicator: ``str``
        :param indicator: indicator value

        :type threats: ``List``
        :param threats: threats data from cofense raw response

        :return: relationships between indicators
        :rtype: ``List``
        """
        relationships = []
        if client.create_relationships:
            for threat in threats:
                for block in threat.get('blockSet', {}):
                    relationships.append(
                        EntityRelationship(name='related-to',
                                           entity_a=indicator,
                                           entity_a_type=entity_a_type,
                                           entity_b=block.get('data'),
                                           entity_b_type=check_indicator_type(block.get('data')),
                                           brand=BRAND))
                for exec_set in threat.get('executableSet', {}):
                    relationships.append(
                        EntityRelationship(name='related-to',
                                           entity_a=indicator,
                                           entity_a_type=entity_a_type,
                                           entity_b=exec_set.get('md5Hex'),
                                           entity_b_type=FeedIndicatorType.File,
                                           brand=BRAND))
        return relationships


    def connectivity_testing(client: Client) -> str:
        """
        Test API connectivity and authentication.

        Returning 'ok' indicates that the integration works like it is supposed to.
        Connection to the service is successful.
        Raises exceptions if something goes wrong.

        :type client: ``Client``
        :param Client: client to use

        :return: 'ok' if test passed, anything else will fail the test.
        :rtype: ``str``
        """
        try:
            client.threat_search_call()
            message = 'ok'
        except DemistoException as e:
            if e.res is not None:
                if e.res.status_code in [401, 403]:
                    message = 'Authorization Error: make sure Token name and password are correctly set'

                elif e.res.status_code == 404:
                    message = 'Not Found: make sure server URL is correct'

            else:
                raise e

        return message


    def search_url_command(client: Client, args: Dict[str, Any], params) -> List[CommandResults]:
        """
        Perform the api call to cofense threts-search endpoint to get all threats associated with the given url.

        Analyze the response and generates the command result object for the url command.

        Args:
            - client (Client): client instance that is responsible for connecting with cofense API
            - args (Dict): the command args- url
            - params (Dict): The integartion params such as threshold, reliability
        return:
         CommandResults: results of the url command including outputs, raw response, readable output
        """
        urls = argToList(args.get('url'))
        days_back = args.get('days_back') if args.get('days_back') else params.get('days_back')
        if not urls:
            raise ValueError('URL not specified')
        results_list = []
        for url in urls:
            result = client.threat_search_call(url=url, days_back=days_back)
            threats = result.get('data', {}).get('threats', [])
            remove_false_vendors_detections_from_threat(threats)
            outputs = {'Data': url, 'Threats': threats}
            md_data, dbot_score = threats_analysis(client.severity_score, threats, indicator=url,
                                                   threshold=params.get('url_threshold'), command='url')

            dbot_score_obj = Common.DBotScore(indicator=url, indicator_type=DBotScoreType.URL,
                                              integration_name=INTEGRATION_NAME, score=dbot_score,
                                              reliability=params.get(RELIABILITY))
            relationships = create_relationship(client, url, threats, FeedIndicatorType.URL)
            url_indicator = Common.URL(url=url, dbot_score=dbot_score_obj, relationships=relationships)

            command_results = CommandResults(
                outputs_prefix=f'{OUTPUT_PREFIX}.URL',
                outputs_key_field='Data',
                outputs=outputs,
                raw_response=result,
                readable_output=tableToMarkdown(name=f'Cofense URL Reputation for url {url}', t=md_data,
                                                headers=['Threat ID', 'Threat Type', 'Verdict', 'Executive Summary',
                                                         'Campaign', 'Malware Family Description', 'Last Published',
                                                         'Threat Report']),
                indicator=url_indicator,
                relationships=relationships)
            results_list.append(command_results)
        return results_list


    def check_ip_command(client: Client, args: Dict[str, Any], params) -> List[CommandResults]:
        """
        Perform the api call to cofense threts-search endpoint to get all threats associated with the given ip.

        Analyze the response and generates the command result object for the ip command.

        Args:
            - client (Client): client instance that is responsible for connecting with cofense API
            - args (Dict): the command args- ip
            - params (Dict): The integration params such as threshold, reliability
        return:
         CommandResults: results of the ip command including outputs, raw response, readable output
        """
        ips = argToList(args.get('ip'))
        days_back = args.get('days_back') if args.get('days_back') else params.get('days_back')
        if not ips:
            raise ValueError('IP not specified')
        results_list = []
        for ip in ips:
            try:
                # verify ip is valid
                socket.inet_aton(ip)

            except socket.error:
                raise ValueError(f'Invalid IP: {ip}')

            # Call the Client function and get the raw response
            result = client.threat_search_call(ip=ip, days_back=days_back)
            threats = result.get('data', {}).get('threats', [])
            remove_false_vendors_detections_from_threat(threats)
            outputs = {'Data': ip, 'Threats': threats}
            dbot_score_obj = Common.DBotScore(indicator=ip, indicator_type=DBotScoreType.IP,
                                              integration_name=INTEGRATION_NAME, score=0,
                                              reliability=params.get(RELIABILITY))
            md_data, dbot_score, ip_indicator = ip_threats_analysis(client.severity_score, threats=threats, ip=ip,
                                                                    threshold=params.get("ip_threshold"),
                                                                    dbot_score_obj=dbot_score_obj)
            relationships = create_relationship(client, ip, threats, FeedIndicatorType.IP)
            dbot_score_obj.score = dbot_score
            ip_indicator.dbot_score = dbot_score_obj
            ip_indicator.relationships = relationships

            command_results = CommandResults(
                outputs_prefix=f'{OUTPUT_PREFIX}.IP',
                outputs_key_field='Data',
                outputs=outputs,
                raw_response=result,
                readable_output=tableToMarkdown(name=f'Cofense IP Reputation for IP {ip}', t=md_data,
                                                headers=['Threat ID', 'Threat Type', 'Verdict', 'Executive Summary',
                                                         'Campaign', 'Malware Family Description', 'Last Published', 'ASN',
                                                         'Country', 'Threat Report']),
                indicator=ip_indicator, relationships=relationships)
            results_list.append(command_results)
        return results_list


    def check_email_command(client: Client, args: Dict[str, Any], params) -> List[CommandResults]:
        """
        Perform the api call to cofense threts-search endpoint to get all threats associated with the given email.

        Analyze the response and generates the command result object for the email command.

        Args:
            - client (Client): client instance that is responsible for connecting with cofense API
            - args (Dict): the command args- email
            - params (Dict): The integration params such as threshold, reliability
        return:
         CommandResults: results of the email command including outputs, raw response, readable output
        """
        emails = argToList(args.get('email'))
        days_back = args.get('days_back') if args.get('days_back') else params.get('days_back')
        if not emails:
            raise ValueError('Email not specified')
        results_list = []
        for email in emails:
            if not re.fullmatch(EMAIL_REGEX, email):
                raise ValueError(f'Invalid email address: {email}')

            # Call the Client function and get the raw response
            result = client.threat_search_call(email=email, days_back=days_back)
            threats = result.get('data', {}).get('threats', [])
            remove_false_vendors_detections_from_threat(threats)
            outputs = {'Data': email, 'Threats': threats}
            md_data, dbot_score = threats_analysis(client.severity_score, threats, indicator=email,
                                                   threshold=params.get('email_threshold'), command="email")

            dbot_score_obj = Common.DBotScore(indicator=email, indicator_type=DBotScoreType.EMAIL,
                                              integration_name=INTEGRATION_NAME, score=dbot_score,
                                              reliability=params.get(RELIABILITY))
            relationships = create_relationship(client, email, threats, FeedIndicatorType.Email)
            email_indicator = Common.EMAIL(address=email, dbot_score=dbot_score_obj, domain=email.split('@')[1],
                                           relationships=relationships)
            command_results = CommandResults(
                outputs_prefix=f'{OUTPUT_PREFIX}.Email',
                outputs=outputs,
                outputs_key_field='Data',
                raw_response=result,
                readable_output=tableToMarkdown(name=f'Cofense email Reputation for email {email}', t=md_data,
                                                headers=['Threat ID', 'Threat Type', 'Verdict', 'Executive Summary',
                                                         'Campaign', 'Malware Family Description', 'Last Published',
                                                         'Threat Report']),
                indicator=email_indicator,
                relationships=relationships
            )
            results_list.append(command_results)
        return results_list


    def check_file_command(client: Client, args: Dict[str, Any], params) -> List[CommandResults]:
        """
        Perform the api call to cofense threts-search endpoint to get all threats associated with the given file hash.

        Analyze the response and generates the command result object for the file command.

        Args:
            - client (Client): client instance that is responsible for connecting with cofense API
            - args (Dict): the command args- file
            - params (Dict): The integration params such as threshold, reliability
        return:
         CommandResults: results of the file command including outputs, raw response, readable output
        """
        files = argToList(args.get('file', None))
        days_back = args.get('days_back') if args.get('days_back') else params.get('days_back')
        if not files:
            raise ValueError('File not specified')
        results_list = []
        for file in files:
            # Call the Client function and get the raw response
            result = client.threat_search_call(file=file, days_back=days_back)
            threats = result.get('data', {}).get('threats', [])
            remove_false_vendors_detections_from_threat(threats)
            outputs = {'Data': file, 'Threats': threats}
            dbot_score_obj = Common.DBotScore(indicator=file, indicator_type=DBotScoreType.FILE,
                                              integration_name=INTEGRATION_NAME, score=0,
                                              reliability=params.get(RELIABILITY))
            md_data, dbot_score, file_indicator = file_threats_analysis(client.severity_score, threats=threats, file=file,
                                                                        threshold=params.get('file_threshold'),
                                                                        dbot_score_obj=dbot_score_obj)
            relationships = create_relationship(client, file, threats, FeedIndicatorType.File)
            file_indicator.relationships = relationships
            file_indicator.dbot_score = dbot_score_obj
            dbot_score_obj.score = dbot_score
            command_results = CommandResults(
                outputs_prefix=f'{OUTPUT_PREFIX}.File',
                outputs_key_field='Data',
                outputs=outputs,
                raw_response=result,
                readable_output=tableToMarkdown(name=f'Cofense file Reputation for file {file}', t=md_data,
                                                headers=['Threat ID', 'Threat Type', 'Verdict', 'Executive Summary',
                                                         'Campaign', 'Malware Family Description', 'Last Published',
                                                         'Threat Report']),
                indicator=file_indicator,
                relationships=relationships)
            results_list.append(command_results)
        return results_list


    def extracted_string(client: Client, args: Dict[str, Any], params) -> CommandResults:
        """
        Perform the api call to cofense threts-search endpoint to get all threats associated with the given string.

        Analyze the response and generates the command result object for the cofense-search command.

        Args:
            - client (Client): client instance that is responsible for connecting with cofense API
            - args (Dict): the command args- string
            - params (Dict): The integartion params such as threshold, reliability
        return:
         CommandResults: results of the cofense-search command including outputs, raw response, readable output
        """
        string = args.get('str')

        limit = arg_to_number(args.get('limit'))
        if not limit:
            limit = 10
        malware_family = args.get('malware_family')
        malware_file = args.get('malware_file')
        malware_subject = args.get('malware_subject')
        url = args.get('url')
        days_back = args.get('days_back') if args.get('days_back') else params.get('days_back')
        begin_time_stamp = get_n_days_back_epoch(int(days_back))  # type:ignore
        params = assign_params(extractedString=string, malwareFamily=malware_family, malwareFile=malware_file,
                               malwareSubject=malware_subject, urlSearch=url,
                               beginTimestamp=begin_time_stamp)
        # Call the Client function and get the raw response
        result = client.search_cofense(params=params)
        threats = result.get('data', {}).get('threats', [])
        md_data = []
        count_threats = 0

        if threats:
            for threat in threats:
                if threat.get('hasReport'):
                    count_threats += 1
                    md_data.append(create_hr_for_cofense_search(threat))
                    if count_threats == limit:
                        break
        remove_false_vendors_detections_from_threat(threats)
        return CommandResults(
            outputs_prefix=f'{OUTPUT_PREFIX}.Threats',
            outputs_key_field='id',
            outputs=threats,
            raw_response=result,
            readable_output=tableToMarkdown(name=f'There are {count_threats} threats regarding your string search\n',
                                            t=md_data,
                                            headers=['Threat ID', 'Threat Type', 'Executive Summary',
                                                     'Campaign', 'Malware Family', 'Malware File', 'Malware Subject',
                                                     'Malware Family Description', 'Last Published',
                                                     'Threat Report']))


    def check_domain_command(client: Client, args: Dict[str, Any], params) -> List[CommandResults]:
        """
        Perform the api call to cofense threts-search endpoint to get all threats associated with the given domain.

        Analyze the response and generates the command result object for the domain command.

        Args:
            - client (Client): client instance that is responsible for connecting with cofense API
            - args (Dict): the command args- domain
            - params (Dict): The integartion params such as threshold, reliability
        return:
         CommandResults: results of the url command including outputs, raw response, readable output
        """
        domains = argToList(args.get('domain'))
        days_back = args.get('days_back') if args.get('days_back') else params.get('days_back')
        if not domains:
            raise ValueError('Domain not specified')
        results_list = []
        for domain in domains:
            result = client.threat_search_call(domain=domain, days_back=days_back)
            threats = result.get('data', {}).get('threats', [])
            remove_false_vendors_detections_from_threat(threats)
            outputs = {'Data': domain, 'Threats': threats}
            md_data, dbot_score = threats_analysis(client.severity_score, threats, indicator=domain,
                                                   threshold=params.get('domain_threshold'), command='domain')
            dbot_score_obj = Common.DBotScore(indicator=domain, indicator_type=DBotScoreType.DOMAIN,
                                              integration_name=INTEGRATION_NAME, score=dbot_score,
                                              reliability=params.get(RELIABILITY))
            relationships = create_relationship(client, domain, threats, FeedIndicatorType.Domain)
            domain_indicator = Common.Domain(domain=domain, dbot_score=dbot_score_obj, relationships=relationships)

            command_results = CommandResults(
                outputs_prefix=f'{OUTPUT_PREFIX}.Domain',
                outputs_key_field='Data',
                outputs=outputs,
                raw_response=result,
                readable_output=tableToMarkdown(name=f'Cofense Domain Reputation for domain {domain}', t=md_data,
                                                headers=['Threat ID', 'Threat Type', 'Verdict', 'Executive Summary',
                                                         'Campaign', 'Malware Family Description', 'Last Published',
                                                         'Threat Report']),
                indicator=domain_indicator,
                relationships=relationships)
            results_list.append(command_results)
        return results_list


    def validate_threat_report_command_args(report_id: str, report_format: str):
        """
        Validate arguments report_id and report_format.

        Args:
            - report_id (str): Unique id to download the specified threat report.
            - report_format (str): Report type to download where allowed types are html and pdf.

        Raises:
         DemistoException: Raise error if invalid argument found.
        """
        if not report_id.isnumeric():
            raise DemistoException("Argument 'report_id' accepts only numeric literals.")
        if report_format not in ["html", "pdf"]:
            raise DemistoException("Argument 'report_format' accepts only 'html' or 'pdf' as input.")


    def threat_report_command(client: Client, args: Dict[str, Any]):
        """
        Download threat report provided by cofense intelligence of an indicator for the given unique report id.

        Args:
            - client (Client): client instance that is responsible for connecting with cofense API
            - args (Dict): the command args- domain
        return:
         CommandResults: results of the report command including outputs, raw response, readable output
        """
        report_id = args.get('report_id', "")
        report_format = args.get("report_format", "html")

        validate_threat_report_command_args(report_id, report_format)

        response = client.get_threat_report(report_id, report_format)
        return fileResult(filename=f'{report_id}.{report_format}', data=response.content)


    def main() -> None:
        """Parse and validate integration params and run commands.

        return:
         command results: results returned from the command that is being called
        """
        params = demisto.params()
        username = demisto.params().get('credentials', {}).get('identifier')
        password = demisto.params().get('credentials', {}).get('password')
        base_url = demisto.params().get('url')
        verify_certificate = not demisto.params().get('insecure', False)
        proxy = demisto.params().get('proxy', False)
        create_relationships = argToBoolean(params.get('create_relationships', True))
        score_mapping = params.get('scoreMapping', "None:0, Minor:1, Moderate:2, Major:3")
        demisto.debug(f'Command being called is {demisto.command()}')
        try:
            headers: Dict = {
                "Authorization": f"Basic {base64.b64encode(':'.join([username, password]).encode()).decode().strip()}"
            }

            client = Client(
                base_url=base_url,
                verify=verify_certificate,
                headers=headers,
                proxy=proxy,
                score_mapping=score_mapping,
                create_relationships=create_relationships
            )

            command = demisto.command()
            args = demisto.args()

            if demisto.command() == 'test-module':
                return_results(connectivity_testing(client))

            elif command == "url":
                return_results(search_url_command(client, args, params))

            elif command == "cofense-search":
                return_results(extracted_string(client, args, params))

            elif command == "email":
                return_results(check_email_command(client, args, params))

            elif command == "file":
                return_results(check_file_command(client, args, params))

            elif command == "ip":
                return_results(check_ip_command(client, args, params))

            elif command == "domain":
                return_results(check_domain_command(client, args, params))

            elif command == "cofense-threat-report-get":
                return_results(threat_report_command(client, args))

        # Log exceptions and return errors
        except Exception as e:
            demisto.error(traceback.format_exc())
            return_error(f'Failed to execute {demisto.command()} command.\nError:\n{str(e)}')


    ''' ENTRY POINT '''
    if __name__ in ('__main__', '__builtin__', 'builtins'):
        main()

    register_module_line('CofenseIntelligenceV2', 'end', __line__())
  subtype: python3
  type: python
system: true
